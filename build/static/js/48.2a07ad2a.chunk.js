"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[48],{64048:(e,i,r)=>{r.r(i),r.d(i,{default:()=>M});var a=r(65043),n=r(83003),t=r(65868),s=r(35475),l=r(62764),o=r(67290),d=r(96651),c=r(3188),h=r(40322),u=r(91898),m=r(91995),x=r(91686),p=r(94434),v=r(76384),g=r(60184),y=r(10254),f=r(34348),j=r.n(f),b=r(70579);const T=e=>{let{trips:i,openDrawer:r,hideAddButton:f,refetch:T}=e;const C=(0,n.wA)(),[N]=(0,t.tJ)(),[w]=(0,t.E8)(),[k,A]=(0,a.useState)({open:!1,severity:"",message:""}),[D,I]=(0,a.useState)(null),[L,S]=(0,a.useState)(!1),[_,H]=(0,a.useState)([]),{data:F,isLoading:P}=(0,l.BI)(),M=(e,i)=>{A({open:!0,severity:e,message:i})},q=[{title:"\u0110i\u1ec3m kh\u1edfi h\xe0nh",dataIndex:["departureLocation","name"],key:"departureLocation"},{title:"\u0110i\u1ec3m \u0111\u1ebfn",dataIndex:["arrivalLocation","name"],key:"arrivalLocation"},{title:"Lo\u1ea1i xe",dataIndex:["busType","name"],key:"busType",render:e=>(0,b.jsx)("span",{className:"bg-green-200 text-green-800 px-2 py-1 rounded-full",children:e})},{title:"Th\u1eddi gian kh\u1edfi h\xe0nh",dataIndex:"departureTime",key:"departureTime",render:e=>y.D.formatDisplayTime(e)},{title:"Th\u1eddi gian \u0111\u1ebfn",dataIndex:"arrivalTime",key:"arrivalTime",render:e=>y.D.formatDisplayTime(e)},{title:"Gi\xe1 v\xe9",dataIndex:"basePrice",key:"basePrice",render:e=>(0,y.v)(e)},{title:"T\xe0i x\u1ebf",dataIndex:"drivers",key:"drivers",render:e=>e&&e.length>0?e.map((e=>(0,b.jsx)("span",{className:"block",children:e.fullName?`${e.fullName} (Driver)`:"Th\xf4ng tin kh\xf4ng x\xe1c \u0111\u1ecbnh"},e._id))):(0,b.jsx)("span",{className:"text-rose-400",children:"Ch\u01b0a c\xf3 t\xe0i x\u1ebf"})},{title:"Thao t\xe1c",key:"action",render:(e,a)=>{const n=a.drivers&&a.drivers.length>0;return(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(d.A,{title:"Chi ti\u1ebft",children:(0,b.jsx)(s.N_,{to:`/trips/${a._id}`,className:"text-blue-500 hover:text-blue-700",children:(0,b.jsx)(g.Ny1,{className:"inline mr-1 text-lg align-middle"})})}),(0,b.jsx)(d.A,{title:"S\u1eeda",children:(0,b.jsx)(c.Ay,{type:"link",className:"text-yellow-500 hover:text-yellow-700",onClick:()=>(e=>{const i={...e,departureTime:j().utc(e.departureTime).toISOString(),arrivalTime:j().utc(e.arrivalTime).toISOString()};r(i)})(a),children:(0,b.jsx)(g.uO9,{className:"inline mr-1 text-lg align-middle"})})}),!n&&(0,b.jsx)(d.A,{title:"Th\xeam t\xe0i x\u1ebf",children:(0,b.jsx)(c.Ay,{type:"link",className:"text-green-500 hover:text-green-700",onClick:()=>(I(a),void S(!0)),children:(0,b.jsx)(g.NPy,{className:"inline mr-1 text-lg align-middle"})})}),(0,b.jsx)(d.A,{title:"X\xf3a",children:(0,b.jsx)(h.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a chuy\u1ebfn \u0111i n\xe0y kh\xf4ng?",onConfirm:()=>(async e=>{try{await N(e).unwrap(),C((0,o.gg)("X\xf3a chuy\u1ebfn \u0111i th\xe0nh c\xf4ng."));const r=i.filter((i=>i._id!==e));C((0,o.hO)(r)),M("success","X\xf3a chuy\u1ebfn \u0111i th\xe0nh c\xf4ng."),T()}catch(r){C((0,o.Nh)("L\u1ed7i khi x\xf3a chuy\u1ebfn \u0111i: "+r.message)),M("error",`L\u1ed7i khi x\xf3a chuy\u1ebfn \u0111i: ${r.message}`)}})(a._id),okText:"C\xf3",cancelText:"Kh\xf4ng",children:(0,b.jsx)(c.Ay,{type:"link",className:"text-red-500 hover:text-red-700",children:(0,b.jsx)(g.qbC,{className:"inline mr-1 text-lg align-middle"})})})})]})}}];return(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)(u.A,{columns:q,dataSource:i,rowKey:e=>e._id,pagination:!1,bordered:!0,className:"bg-white shadow-md rounded-lg overflow-hidden"}),(0,b.jsx)(v.A,{open:k.open,severity:k.severity,message:k.message,onClose:()=>A({...k,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"}}),(0,b.jsx)(m.A,{title:"Th\xeam t\xe0i x\u1ebf",visible:L,onOk:async()=>{if(_.length)try{await w({tripId:D._id,driverIds:_}).unwrap(),M("success","Th\xeam t\xe0i x\u1ebf th\xe0nh c\xf4ng."),S(!1),T()}catch(r){var e,i;const a=(null===(e=r.data)||void 0===e?void 0:e.message)||"L\u1ed7i khi th\xeam t\xe0i x\u1ebf.",n=(null===(i=r.data)||void 0===i?void 0:i.conflictingDrivers)||[],t=n.length?`C\xe1c t\xe0i x\u1ebf g\xe2y xung \u0111\u1ed9t: ${n.join(", ")}`:"";M("error",`${a} ${t}`)}else M("error","B\u1ea1n ph\u1ea3i ch\u1ecdn \xedt nh\u1ea5t m\u1ed9t t\xe0i x\u1ebf")},onCancel:()=>S(!1),children:P?(0,b.jsx)(x.A,{}):F&&Array.isArray(F.drivers)&&F.drivers.length>0?(0,b.jsx)(p.A,{mode:"multiple",style:{width:"100%"},placeholder:"Ch\u1ecdn t\xe0i x\u1ebf",onChange:e=>H(e),children:F.drivers.map((e=>{var i;return(0,b.jsx)(p.A.Option,{value:e._id,children:null!==(i=e.userId)&&void 0!==i&&i.fullName?e.userId.fullName:"T\xean kh\xf4ng x\xe1c \u0111\u1ecbnh"},e._id)}))}):(0,b.jsx)("p",{children:"Kh\xf4ng c\xf3 t\xe0i x\u1ebf n\xe0o"})})]})};var C=r(31899),N=r.n(C),w=(r(25015),r(39052)),k=r(90480);r(86178);const A=e=>{var i,r;let{tripId:s,closeDrawer:l}=e;const{companyId:o}=(0,n.d4)((e=>e.user.userInfo)),[d]=(0,t._w)(),[c]=(0,t.Lr)(),{data:h}=(0,t.pY)(s,{skip:!s}),{data:u,isLoading:m}=(0,w.eg)(),{data:x,isLoading:p,error:v}=(0,k.rz)({companyId:o},{skip:!o}),[g,f]=(0,a.useState)({departureLocation:"",arrivalLocation:"",busType:"",departureTime:new Date,arrivalTime:new Date,basePrice:"",isRoundTrip:!1});(0,a.useEffect)((()=>{if(h&&h.data){var e,i,r;const a=h.data.trip;console.log("Server time:",a.departureTime),console.log("Parsed time for form:",y.D.parseUTCTimeForForm(a.departureTime)),f({departureLocation:(null===a||void 0===a||null===(e=a.departureLocation)||void 0===e?void 0:e._id)||"",arrivalLocation:(null===a||void 0===a||null===(i=a.arrivalLocation)||void 0===i?void 0:i._id)||"",busType:(null===a||void 0===a||null===(r=a.busType)||void 0===r?void 0:r._id)||"",departureTime:y.D.parseUTCTimeForForm(a.departureTime),arrivalTime:y.D.parseUTCTimeForForm(a.arrivalTime),basePrice:null===a||void 0===a?void 0:a.basePrice,isRoundTrip:(null===a||void 0===a?void 0:a.isRoundTrip)||!1})}}),[h]);const j=e=>{const{name:i,value:r,type:a,checked:n}=e.target;f({...g,[i]:"checkbox"===a?n:r})},T=(e,i)=>{f({...g,[e]:i})};return(0,b.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e={...g,companyId:o,departureTime:y.D.formatTimeForServer(g.departureTime),arrivalTime:y.D.formatTimeForServer(g.arrivalTime),basePrice:parseInt(g.basePrice,10)};s?await c({tripId:s,updatedTrip:e}).unwrap():await d(e).unwrap(),l()}catch(i){console.error("L\u1ed7i khi l\u01b0u chuy\u1ebfn \u0111i:",i)}},className:"p-6 bg-white rounded-lg shadow-lg",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gray-700",children:s?"S\u1eeda Chuy\u1ebfn \u0110i":"T\u1ea1o Chuy\u1ebfn \u0110i M\u1edbi"}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m Kh\u1edfi H\xe0nh:"}),(0,b.jsxs)("select",{name:"departureLocation",value:g.departureLocation,onChange:j,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Ch\u1ecdn \u0111i\u1ec3m kh\u1edfi h\xe0nh"}),!m&&(null===u||void 0===u||null===(i=u.data)||void 0===i?void 0:i.map((e=>(0,b.jsxs)("option",{value:e._id,children:[e.name," - ",e.city]},e._id))))]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m \u0110\u1ebfn:"}),(0,b.jsxs)("select",{name:"arrivalLocation",value:g.arrivalLocation,onChange:j,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Ch\u1ecdn \u0111i\u1ec3m \u0111\u1ebfn"}),!m&&(null===u||void 0===u||null===(r=u.data)||void 0===r?void 0:r.map((e=>(0,b.jsxs)("option",{value:e._id,children:[e.name," - ",e.city]},e._id))))]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Lo\u1ea1i Xe:"}),p?(0,b.jsx)("p",{children:"\u0110ang t\u1ea3i danh s\xe1ch lo\u1ea1i xe..."}):v?(0,b.jsxs)("p",{className:"text-red-500",children:["L\u1ed7i khi t\u1ea3i danh s\xe1ch lo\u1ea1i xe: ",v.message]}):(0,b.jsxs)("select",{name:"busType",value:g.busType,onChange:j,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Ch\u1ecdn lo\u1ea1i xe"}),null===x||void 0===x?void 0:x.data.map((e=>(0,b.jsx)("option",{value:e._id,children:e.name},e._id)))]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Th\u1eddi Gian Kh\u1edfi H\xe0nh:"}),(0,b.jsx)(N(),{selected:g.departureTime,onChange:e=>T("departureTime",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"dd/MM/yyyy HH:mm",className:"mt-2 p-3 border border-gray-300 text-gray-700 rounded-lg shadow-sm w-full \r focus:outline-none focus:border-blue-400 focus:ring focus:ring-blue-200 \r transition duration-200 ease-in-out hover:shadow-lg",required:!0})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Th\u1eddi Gian \u0110\u1ebfn:"}),(0,b.jsx)(N(),{selected:g.arrivalTime,onChange:e=>T("arrivalTime",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"dd/MM/yyyy HH:mm",className:"mt-2 p-3 border border-gray-300 text-gray-700 rounded-lg shadow-sm w-full \r focus:outline-none focus:border-blue-400 focus:ring focus:ring-blue-200 \r transition duration-200 ease-in-out hover:shadow-lg",required:!0})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Gi\xe1 V\xe9 C\u01a1 B\u1ea3n:"}),(0,b.jsx)("input",{type:"number",name:"basePrice",value:g.basePrice,onChange:j,placeholder:"Nh\u1eadp gi\xe1 v\xe9 c\u01a1 b\u1ea3n",className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0}),(0,b.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["Gi\xe1 v\xe9: ",(0,y.v)(g.basePrice)]})]}),(0,b.jsx)("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded w-full",children:s?"C\u1eadp Nh\u1eadt Chuy\u1ebfn \u0110i":"T\u1ea1o Chuy\u1ebfn \u0110i"})]})};var D=r(23927),I=r(8918),L=r(80349),S=r(6051),_=r(42261),H=r(48677);const{Title:F}=D.A,{TabPane:P}=I.A,M=()=>{const e=(0,n.d4)((e=>{var i;return null===(i=e.user.userInfo)||void 0===i?void 0:i.companyId})),[i,r]=(0,a.useState)(!1),[s,l]=(0,a.useState)(null),[o,d]=(0,a.useState)("add"),[u,m]=(0,a.useState)("active"),{data:p={},isLoading:v,error:g,refetch:y}=(0,t.CI)(e,{skip:!e}),f=p.trips||[],{activeTrips:j,completedTrips:C}=(0,a.useMemo)((()=>{const e=[],i=[];return f.forEach((r=>{"Completed"===r.status?i.push(r):e.push(r)})),{activeTrips:e,completedTrips:i}}),[f]),[N,{isLoading:w}]=(0,t.D1)(),k=(0,a.useCallback)(((e,i,r)=>{L.Ay[e]({message:i,description:r})}),[]),D=(0,a.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;l(e?e._id:null),d(e?"edit":"add"),r(!0)}),[]),M=(0,a.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1?arguments[1]:void 0;r(!1),l(null),d("add"),e&&k("success","Th\xe0nh c\xf4ng",i),y()}),[k,y]);return(0,b.jsxs)("div",{className:"container mx-auto p-8 bg-white shadow-md rounded-md",children:[(0,b.jsxs)("div",{className:"header flex justify-between items-center mb-6",children:[(0,b.jsx)(F,{level:3,className:"text-gray-800",children:"Qu\u1ea3n L\xfd Chuy\u1ebfn \u0110i"}),(0,b.jsxs)(S.A,{size:"large",children:["active"===u&&(0,b.jsx)(h.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a t\u1ea5t c\u1ea3 c\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n?",onConfirm:async()=>{try{const e=await N().unwrap();k("success","Th\xe0nh c\xf4ng",e.message||"C\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n \u0111\xe3 \u0111\u01b0\u1ee3c x\xf3a th\xe0nh c\xf4ng."),y()}catch(g){var e;const r=(null===g||void 0===g||null===(e=g.data)||void 0===e?void 0:e.message)||"C\xf3 l\u1ed7i x\u1ea3y ra khi x\xf3a c\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n.";k("error","L\u1ed7i",r)}},okText:"X\xf3a",cancelText:"H\u1ee7y",children:(0,b.jsx)(c.Ay,{type:"primary",danger:!0,loading:w,style:{backgroundColor:"#ff4d4f",borderColor:"#ff4d4f"},children:"X\xf3a Chuy\u1ebfn \u0110i Qu\xe1 H\u1ea1n"})}),"active"===u&&(0,b.jsx)(c.Ay,{type:"primary",onClick:()=>D(),children:"T\u1ea1o Chuy\u1ebfn \u0110i"})]})]}),(0,b.jsx)("div",{className:"content",children:(0,b.jsxs)(I.A,{activeKey:u,onChange:e=>{m(e)},type:"card",children:[(0,b.jsx)(P,{tab:"Chuy\u1ebfn \u0111i \u0111ang ho\u1ea1t \u0111\u1ed9ng",children:v?(0,b.jsx)("div",{className:"loading-spinner flex justify-center py-10",children:(0,b.jsx)(x.A,{tip:"\u0110ang t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i...",size:"large"})}):g?(0,b.jsx)(_.A,{message:"C\xf3 l\u1ed7i x\u1ea3y ra khi t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i",description:g.message,type:"error",showIcon:!0,className:"error-alert"}):(0,b.jsx)(T,{trips:j,openDrawer:D,hideAddButton:i,showNotification:k,refetch:y})},"active"),(0,b.jsx)(P,{tab:"Chuy\u1ebfn \u0111i \u0111\xe3 ho\xe0n th\xe0nh",children:v?(0,b.jsx)("div",{className:"loading-spinner flex justify-center py-10",children:(0,b.jsx)(x.A,{tip:"\u0110ang t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i...",size:"large"})}):g?(0,b.jsx)(_.A,{message:"C\xf3 l\u1ed7i x\u1ea3y ra khi t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i",description:g.message,type:"error",showIcon:!0,className:"error-alert"}):(0,b.jsx)(T,{trips:C,openDrawer:D,hideAddButton:i,showNotification:k,refetch:y,isCompleted:!0})},"completed")]})}),(0,b.jsx)(H.A,{title:s?"Ch\u1ec9nh S\u1eeda Chuy\u1ebfn \u0110i":"Th\xeam Chuy\u1ebfn \u0110i M\u1edbi",width:500,onClose:()=>M(!1),open:i,destroyOnClose:!0,children:(0,b.jsx)(A,{tripId:s,closeDrawer:e=>M(!0,e),trips:f,formMode:o,showNotification:k})})]})}},76384:(e,i,r)=>{r.d(i,{A:()=>d});var a=r(65043),n=r(90182),t=r(77518),s=r(5897),l=r(70579);const o=a.forwardRef((function(e,i){return(0,l.jsx)(t.A,{elevation:6,ref:i,variant:"filled",...e})})),d=e=>{let{open:i,onClose:r,severity:a,message:t,autoHideDuration:d=3e3,TransitionComponent:c=s.A}=e;return(0,l.jsx)(n.A,{open:i,autoHideDuration:d,onClose:r,TransitionComponent:c,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,l.jsx)(o,{onClose:r,severity:a,sx:{width:"100%"},children:t})})}},10254:(e,i,r)=>{r.d(i,{D:()=>t,v:()=>s});var a=r(34348),n=r.n(a);const t={parseUTCTimeForForm:e=>e?new Date(e):new Date,formatTimeForServer:e=>e?n()(e).utc().format():null,formatDisplayTime:e=>e?n()(e).tz("Asia/Ho_Chi_Minh").format("DD/MM/YYYY HH:mm"):""},s=e=>e?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e):"0 VND"}}]);
//# sourceMappingURL=48.2a07ad2a.chunk.js.map