"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[480],{5480:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var s=n(65043),a=n(73216),r=n(60184),o=n(3836),l=n(48970),i=n(76384),d=n(70579);const c=e=>{let{initialTime:t,onTimeout:n,sessionId:a}=e;const[r,o]=(0,s.useState)(t);(0,s.useEffect)((()=>{const e=localStorage.getItem("currentSessionId"),s=parseInt(localStorage.getItem("countdownEndTime"),10);if(e!==a||isNaN(s)){const e=Date.now()+1e3*t;localStorage.setItem("currentSessionId",a),localStorage.setItem("countdownEndTime",e),o(t)}else{const e=Math.floor((s-Date.now())/1e3);o(e>0?e:0)}const r=setInterval((()=>{o((e=>e<=1?(clearInterval(r),localStorage.removeItem("currentSessionId"),localStorage.removeItem("countdownEndTime"),n(),0):e-1))}),1e3);return()=>clearInterval(r)}),[t,n,a]);const l=String(Math.floor(r/60)).padStart(2,"0"),i=String(r%60).padStart(2,"0");return(0,d.jsxs)("div",{className:"w-full text-center font-bold mb-8 p-4 rounded-lg shadow-lg flex flex-col items-center",style:{background:"linear-gradient(135deg, #3a8dff, #1e40af)",color:"white",borderRadius:"8px",boxShadow:"0 6px 12px rgba(0, 0, 0, 0.2)"},children:[(0,d.jsx)("p",{className:"text-lg tracking-wide",style:{marginBottom:"8px"},children:"Th\u1eddi gian thanh to\xe1n c\xf2n l\u1ea1i"}),(0,d.jsxs)("div",{className:"bg-white text-red-600 font-extrabold text-5xl px-6 py-2 rounded-md shadow-md inline-block",style:{boxShadow:"0 4px 15px rgba(0, 0, 0, 0.1)",fontFamily:"monospace"},children:[l,":",i]})]})};var h=n(51238);const m=e=>{let{qrCodeData:t}=e;const[n,a]=(0,s.useState)("");return(0,s.useEffect)((()=>{t&&l.toDataURL(t,{width:256,margin:2,color:{dark:"#000",light:"#FFF"}}).then((e=>{a(e)})).catch((e=>{console.error("L\u1ed7i t\u1ea1o QR code:",e)}))}),[t]),n?(0,d.jsx)("div",{className:"flex flex-col items-center",children:(0,d.jsx)("img",{src:n,alt:"QR Code",className:"w-48 h-48 shadow-md rounded-lg"})}):(0,d.jsx)("div",{className:"text-center p-4",children:"\u0110ang t\u1ea1o m\xe3 QR..."})},g=()=>{var e,t;const n=(0,a.zy)(),l=(0,a.Zp)(),{selectedSeats:g,totalPrice:x,trip:u}=n.state||{},[b,p]=(0,s.useState)(null),[y,{isLoading:f,isError:v,data:j,isSuccess:w}]=(0,o.oN)(),[N,S]=(0,s.useState)({open:!1,message:"",severity:"success"}),[k,I]=(0,s.useState)(!1),[C,T]=(0,s.useState)(localStorage.getItem("currentSessionId")||(0,h.A)());(0,s.useEffect)((()=>{localStorage.setItem("currentSessionId",C)}),[C]);const O=function(e){S({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})};(0,s.useEffect)((()=>{w&&"OnBoard"===b&&(O("\u0110\u1eb7t ch\u1ed7 th\xe0nh c\xf4ng! B\u1ea1n s\u1ebd thanh to\xe1n khi l\xean xe."),l("/user/ticket-buy"))}),[w,b,l]);return(0,d.jsxs)("div",{className:"container mx-auto p-6 bg-gray-50 min-h-screen",children:[(0,d.jsx)(c,{initialTime:300,sessionId:C,onTimeout:()=>{I(!0)}}),k&&(0,d.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center",children:(0,d.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-sm w-full text-center",children:[(0,d.jsx)("p",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Th\u1eddi gian \u0111\xe3 h\u1ebft. B\u1ea1n c\xf3 mu\u1ed1n quay l\u1ea1i trang tr\u01b0\u1edbc kh\xf4ng?"}),(0,d.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,d.jsx)("button",{onClick:()=>{l(-1)},className:"bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition duration-300",children:"X\xe1c nh\u1eadn"}),(0,d.jsx)("button",{onClick:()=>{I(!1)},className:"bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-300",children:"H\u1ee7y b\u1ecf"})]})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,d.jsxs)("div",{className:"lg:col-span-2 bg-white p-8 rounded-xl shadow-lg",children:[(0,d.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Ph\u01b0\u01a1ng th\u1ee9c thanh to\xe1n"}),(0,d.jsxs)("div",{className:"mb-6 border border-gray-300 rounded-lg p-6 flex items-center cursor-pointer hover:shadow-md transition-shadow duration-200 "+("Online"===b?"border-blue-500 bg-blue-50":""),onClick:()=>p("Online"),children:[(0,d.jsx)(r.Acq,{className:"text-3xl text-blue-500 mr-4"}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("input",{type:"radio",id:"qr",name:"payment",className:"mr-3 mt-1",checked:"Online"===b,onChange:()=>p("Online")}),(0,d.jsx)("label",{htmlFor:"qr",className:"text-lg font-medium text-gray-700",children:"QR chuy\u1ec3n kho\u1ea3n / V\xed \u0111i\u1ec7n t\u1eed"}),(0,d.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"H\u1ed7 tr\u1ee3 nhi\u1ec1u v\xed \u0111i\u1ec7n t\u1eed & 42 ng\xe2n h\xe0ng"})]})]}),(0,d.jsxs)("div",{className:"mb-6 border border-gray-300 rounded-lg p-6 flex items-center cursor-pointer hover:shadow-md transition-shadow duration-200 "+("OnBoard"===b?"border-green-500 bg-green-50":""),onClick:()=>p("OnBoard"),children:[(0,d.jsx)(r.dZW,{className:"text-3xl text-green-500 mr-4"}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("input",{type:"radio",id:"onboard",name:"payment",className:"mr-3 mt-1",checked:"OnBoard"===b,onChange:()=>p("OnBoard")}),(0,d.jsx)("label",{htmlFor:"onboard",className:"text-lg font-medium text-gray-700",children:"Thanh to\xe1n khi l\xean xe"}),(0,d.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"B\u1ea1n c\xf3 th\u1ec3 thanh to\xe1n cho t\xe0i x\u1ebf khi l\xean xe"})]})]}),v&&(0,d.jsx)("p",{className:"text-red-500 mt-4",children:"\u0110\xe3 c\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i."}),!w&&(0,d.jsxs)("button",{className:"w-full bg-yellow-500 text-white font-semibold py-3 rounded-lg hover:bg-yellow-600 transition duration-300 flex items-center justify-center mt-4",onClick:async()=>{if(!b)return void O("Vui l\xf2ng ch\u1ecdn ph\u01b0\u01a1ng th\u1ee9c thanh to\xe1n","error");if(!u||!g||!x)return void O("D\u1eef li\u1ec7u kh\xf4ng h\u1ee3p l\u1ec7","error");const e={tripId:u._id,seatNumbers:g,paymentMethod:b};try{const t=await y(e).unwrap();"Online"===b&&(O("\u0110\u1eb7t ch\u1ed7 th\xe0nh c\xf4ng! Vui l\xf2ng nh\u1ea5n v\xe0o li\xean k\u1ebft \u0111\u1ec3 thanh to\xe1n...","success"),setTimeout((()=>{window.open(t.data.paymentLink,"_self")}),2e3)),localStorage.removeItem("currentSessionId"),localStorage.removeItem("countdownEndTime");const n=(0,h.A)();T(n),localStorage.setItem("currentSessionId",n)}catch(t){console.error("L\u1ed7i khi \u0111\u1eb7t ch\u1ed7:",t),O("C\xf3 l\u1ed7i x\u1ea3y ra khi \u0111\u1eb7t ch\u1ed7. Vui l\xf2ng th\u1eed l\u1ea1i.","error")}},disabled:f,children:[(0,d.jsx)(r.tVd,{className:"mr-2"})," ",f?"\u0110ang \u0111\u1eb7t ch\u1ed7...":"\u0110\u1eb7t ch\u1ed7"]})]}),(0,d.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-lg",children:[(0,d.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Th\xf4ng tin thanh to\xe1n"}),w&&(0,d.jsxs)("div",{className:"space-y-6",children:[(null===j||void 0===j||null===(e=j.data)||void 0===e?void 0:e.qrCode)&&(0,d.jsxs)("div",{className:"p-4 border border-gray-200 rounded-lg shadow-sm bg-gray-100",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-700 mb-3",children:"Qu\xe9t m\xe3 QR \u0111\u1ec3 thanh to\xe1n"}),(0,d.jsx)(m,{qrCodeData:j.data.qrCode})]}),(null===j||void 0===j||null===(t=j.data)||void 0===t?void 0:t.paymentLink)&&(0,d.jsxs)("div",{className:"p-4 border border-gray-200 rounded-lg shadow-sm bg-gray-100",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-700 mb-3",children:"Thanh to\xe1n qua li\xean k\u1ebft"}),(0,d.jsxs)("button",{onClick:()=>{var e;null!==j&&void 0!==j&&null!==(e=j.data)&&void 0!==e&&e.paymentLink&&window.open(j.data.paymentLink,"_self")},className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300 flex items-center justify-center",children:[(0,d.jsx)(r.AnD,{className:"mr-2"})," Chuy\u1ec3n \u0111\u1ebfn trang thanh to\xe1n"]})]})]}),(0,d.jsxs)("div",{className:"mt-6 p-6 border border-gray-200 rounded-lg shadow-sm bg-gray-100 flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-gray-700 mb-2",children:"T\u1ed5ng ti\u1ec1n"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:x?`${x.toLocaleString("vi-VN")} VND`:"Ch\u01b0a c\xf3 th\xf4ng tin gi\xe1"})]}),(0,d.jsx)(r.dZW,{className:"text-4xl text-blue-600"})]})]})]}),(0,d.jsx)(i.A,{open:N.open,onClose:()=>{S({...N,open:!1})},severity:N.severity,message:N.message})]})}},76384:(e,t,n)=>{n.d(t,{A:()=>d});var s=n(65043),a=n(90182),r=n(77518),o=n(5897),l=n(70579);const i=s.forwardRef((function(e,t){return(0,l.jsx)(r.A,{elevation:6,ref:t,variant:"filled",...e})})),d=e=>{let{open:t,onClose:n,severity:s,message:r,autoHideDuration:d=3e3,TransitionComponent:c=o.A}=e;return(0,l.jsx)(a.A,{open:t,autoHideDuration:d,onClose:n,TransitionComponent:c,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,l.jsx)(i,{onClose:n,severity:s,sx:{width:"100%"},children:r})})}}}]);
//# sourceMappingURL=480.713a9c5e.chunk.js.map