"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[922],{26922:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=s(65043),n=s(3836),l=s(85627),r=s(6720),c=s(75995),i=s(73216),d=s(91995),o=s(60184),m=s(70579);const x=e=>{var t,s,a,n,l;let{booking:c,onCancel:i,onReview:d,activeTab:o}=e;const x=(null===(t=c.trip)||void 0===t||null===(s=t.departureLocation)||void 0===s?void 0:s.name)||"N/A",h=(null===(a=c.trip)||void 0===a||null===(n=a.arrivalLocation)||void 0===n?void 0:n.name)||"N/A",u=null!==(l=c.trip)&&void 0!==l&&l.departureTime?new Date(c.trip.departureTime):null;return(0,m.jsxs)("div",{className:"bg-gray-50 shadow-lg rounded-lg p-6 mb-4 transition-transform transform hover:scale-105",children:[(0,m.jsxs)("div",{className:"flex justify-between items-start",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 flex items-center",children:[(0,m.jsx)(r.gwi,{className:"text-blue-500 mr-2"}),x," \u2192 ",h]}),(0,m.jsxs)("p",{className:"text-sm text-gray-600 flex items-center mt-1",children:[(0,m.jsx)(r.Hvs,{className:"text-blue-500 mr-2"}),u?`${u.toLocaleDateString()} - ${u.toLocaleTimeString()}`:"Th\u1eddi gian kh\xf4ng c\xf3 s\u1eb5n"]})]}),(0,m.jsx)("span",{className:"px-3 py-1 text-xs rounded-full font-semibold "+("Confirmed"===c.status?"bg-green-100 text-green-600":"Completed"===c.status?"bg-blue-100 text-blue-600":"bg-red-100 text-red-600"),children:c.status})]}),(0,m.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"flex items-center text-gray-700 mb-2",children:[(0,m.jsx)(r.r$9,{className:"text-blue-500 mr-2"}),(0,m.jsx)("span",{className:"font-semibold",children:"Gh\u1ebf:"})," ",c.seatNumbers.join(", ")]}),(0,m.jsxs)("div",{className:"flex items-center text-gray-700 mb-2",children:[(0,m.jsx)("span",{className:"text-blue-500 mr-2",children:"\ud83d\udcb2"}),(0,m.jsx)("span",{className:"font-semibold",children:"Gi\xe1 v\xe9:"})," ",c.totalPrice.toLocaleString()," VND"]}),(0,m.jsxs)("div",{className:"flex items-center text-gray-700",children:[(0,m.jsx)(r.WYw,{className:"text-blue-500 mr-2"}),(0,m.jsx)("span",{className:"font-semibold",children:"M\xe3 \u0111\u1eb7t v\xe9:"})," ",c.orderCode]})]}),"Confirmed"===c.status&&"completed"!==o&&(0,m.jsx)("button",{onClick:()=>i(c._id),className:"bg-red-500 text-white px-4 py-2 rounded-lg",children:"H\u1ee7y v\xe9"}),"completed"===o&&(0,m.jsx)("button",{onClick:()=>d(c),className:"bg-yellow-500 text-white px-4 py-2 rounded-lg",children:"\u0110\xe1nh gi\xe1"})]})]})},h=e=>{let{totalPages:t,currentPage:s,onPageChange:a,onNextPage:n,onPrevPage:l}=e;return(0,m.jsxs)("div",{className:"flex justify-center mt-6 space-x-2",children:[(0,m.jsx)("button",{onClick:l,disabled:1===s,className:"px-3 py-1 rounded-lg "+(1===s?"bg-gray-300 cursor-not-allowed":"bg-blue-500 text-white"),children:"Quay l\u1ea1i"}),[...Array(t).keys()].map((e=>(0,m.jsx)("button",{onClick:()=>a(e+1),className:"px-3 py-1 rounded-lg "+(e+1===s?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:e+1},e+1))),(0,m.jsx)("button",{onClick:n,disabled:s===t,className:"px-3 py-1 rounded-lg "+(s===t?"bg-gray-300 cursor-not-allowed":"bg-blue-500 text-white"),children:"Trang ti\u1ebfp"})]})},u=()=>{const[e,t]=(0,a.useState)([]),[s,u]=(0,a.useState)({current:0,completed:0,canceled:0}),[g,p]=(0,a.useState)("current"),[b,j]=(0,a.useState)(1),{data:v,isLoading:y,isError:f,refetch:N}=(0,n.dH)(),[w]=(0,n.wC)(),C=(0,i.zy)(),[k,P]=(0,a.useState)(!1),[S,T]=(0,a.useState)(!1),[L,$]=(0,a.useState)(null),[D,H]=(0,a.useState)(!1),[O,A]=(0,a.useState)(null),[M,B]=(0,a.useState)(5),[R,E]=(0,a.useState)(""),[G]=(0,l.Dk)(),I=e=>{A(e),H(!0)};(0,a.useEffect)((()=>{const e=new URLSearchParams(C.search),t=e.get("success"),s=e.get("message");"true"===t&&s&&_({open:!0,severity:"success",message:s})}),[C]),(0,a.useEffect)((()=>{if(C.state){const{orderCode:e,trip:t,seatNumbers:s,totalPrice:a,paymentMethod:n}=C.state;$({orderCode:e,trip:t,seatNumbers:s,totalPrice:a,paymentMethod:n}),T(!0)}}),[C]);const U=()=>{T(!1)},[V,_]=(0,a.useState)({open:!1,severity:"info",message:""}),F=(e,t)=>{_({open:!0,severity:e,message:t})};(0,a.useEffect)((()=>{if(null!==v&&void 0!==v&&v.success){const e=v.data.reduce(((e,t)=>{var s,a;const n=new Date(t.bookingDate).toLocaleDateString();let l;return"Scheduled"===(null===(s=t.trip)||void 0===s?void 0:s.status)&&"Confirmed"===t.status?l="current":"Completed"===(null===(a=t.trip)||void 0===a?void 0:a.status)&&"Confirmed"===t.status?l="completed":"Cancelled"===t.status&&(l="canceled"),l&&(e[l]||(e[l]={}),e[l][n]||(e[l][n]=[]),e[l][n].push(t)),e}),{});t(e),u({current:e.current?Object.values(e.current).flat().length:0,completed:e.completed?Object.values(e.completed).flat().length:0,canceled:e.canceled?Object.values(e.canceled).flat().length:0})}}),[v]);const z=e=>{j(e)},K=()=>{j((e=>e+1))},Q=()=>{j((e=>Math.max(e-1,1)))},W=async e=>{try{await w(e).unwrap(),F("success","H\u1ee7y v\xe9 th\xe0nh c\xf4ng!"),N()}catch(t){F("error",`L\u1ed7i khi h\u1ee7y v\xe9: ${t.message}`)}};if(y)return(0,m.jsx)("p",{children:"Loading..."});if(f||null===v||void 0===v||!v.success)return(0,m.jsx)("div",{className:"container mx-auto mt-10 bg-white shadow-md rounded-lg p-8",children:(0,m.jsxs)("p",{children:["B\u1ea1n ch\u01b0a c\xf3 l\u1ecbch s\u1eed \u0111\u1eb7t v\xe9 n\xe0o. ",(0,m.jsx)("a",{href:"/",className:"text-blue-600",children:"\u0110\u1eb7t v\xe9 ngay!"})]})});return(0,m.jsxs)("div",{className:"container mx-auto mt-10 bg-white shadow-md rounded-lg p-8",children:[(0,m.jsx)("div",{className:"border-b border-gray-300 mb-6",children:(0,m.jsx)("nav",{className:"flex justify-center space-x-8",children:["current","completed","canceled"].map((e=>(0,m.jsx)("button",{onClick:()=>{p(e),j(1)},className:"py-3 px-4 text-lg font-semibold "+(g===e?"text-blue-600 border-b-2 border-blue-500":"text-gray-600"),children:"current"===e?`Hi\u1ec7n t\u1ea1i (${s.current})`:"completed"===e?`\u0110\xe3 \u0111i (${s.completed})`:`\u0110\xe3 h\u1ee7y (${s.canceled})`},e)))})}),(0,m.jsx)("div",{children:(t=>{const s=e[t];if(!s||0===Object.keys(s).length)return(0,m.jsxs)("p",{className:"text-gray-600",children:["current"===t?"B\u1ea1n ch\u01b0a c\xf3 chuy\u1ebfn s\u1eafp \u0111i n\xe0o. ":"completed"===t?"B\u1ea1n ch\u01b0a c\xf3 chuy\u1ebfn n\xe0o \u0111\xe3 ho\xe0n th\xe0nh.":"B\u1ea1n ch\u01b0a c\xf3 v\xe9 n\xe0o \u0111\xe3 h\u1ee7y.","current"===t&&(0,m.jsx)("a",{href:"/book",className:"text-blue-600",children:"\u0110\u1eb7t chuy\u1ebfn \u0111i ngay!"})]});const a=Object.entries(s),n=Math.ceil(a.length/5),l=a.slice(5*(b-1),5*b);return(0,m.jsxs)(m.Fragment,{children:[l.map((e=>{let[t,s]=e;return(0,m.jsxs)("div",{className:"mb-8",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:t}),s.map((e=>(0,m.jsx)(x,{booking:e,activeTab:g,onCancel:W,onReview:I},e._id)))]},t)})),(0,m.jsx)(h,{totalPages:n,currentPage:b,onPageChange:z,onNextPage:K,onPrevPage:Q})]})})(g)}),(0,m.jsx)(d.A,{title:"Th\xf4ng Tin \u0110\u01a1n H\xe0ng",visible:S,onOk:U,onCancel:U,okText:"X\xe1c nh\u1eadn",cancelText:"\u0110\xf3ng",children:L&&(0,m.jsxs)("div",{className:"space-y-8 text-gray-700",children:[(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("p",{className:"font-medium text-gray-500 mr-2",children:"M\xe3 \u0111\u01a1n h\xe0ng:"}),(0,m.jsx)("p",{className:"text-lg font-semibold",children:L.orderCode})]}),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)(r.r$9,{className:"text-blue-500 mr-2"}),(0,m.jsx)("p",{className:"font-medium text-gray-500 mr-2",children:"Gh\u1ebf:"}),(0,m.jsx)("p",{className:"text-lg font-semibold",children:L.seatNumbers.join(", ")})]}),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)(o.GeR,{className:"text-green-500 mr-2"}),(0,m.jsx)("p",{className:"font-medium text-gray-500 mr-2",children:"T\u1ed5ng ti\u1ec1n:"}),(0,m.jsxs)("p",{className:"text-lg font-bold text-green-600",children:[L.totalPrice.toLocaleString()," VND"]})]}),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)(o.bfZ,{className:"text-gray-500 mr-2"}),(0,m.jsx)("p",{className:"font-medium text-gray-500 mr-2",children:"Ph\u01b0\u01a1ng th\u1ee9c thanh to\xe1n:"}),(0,m.jsx)("p",{className:"text-lg font-semibold",children:"OnBoard"===L.paymentMethod?"Thanh to\xe1n khi l\xean xe":"Thanh to\xe1n online"})]})]})}),(0,m.jsx)(d.A,{title:(0,m.jsx)("div",{className:"modal-header",children:(0,m.jsx)("h2",{className:"text-xl font-bold text-blue-600",children:"\u0110\xe1nh gi\xe1 chuy\u1ebfn \u0111i"})}),visible:D,onOk:async()=>{var e;if(O&&null!==(e=O.trip)&&void 0!==e&&e.companyId){P(!0);try{const e=new FormData;e.append("companyId",O.trip.companyId._id||O.trip.companyId),e.append("rating",M),e.append("comment",R),O.images&&O.images.length>0&&O.images.forEach((t=>{e.append("images",t)})),await G(e).unwrap(),H(!1),B(5),E(""),F("success","\u0110\xe1nh gi\xe1 th\xe0nh c\xf4ng!"),N()}catch(t){F("error",`L\u1ed7i khi \u0111\xe1nh gi\xe1: ${t.message}`)}finally{P(!1)}}else F("error","Kh\xf4ng th\u1ec3 \u0111\xe1nh gi\xe1. Vui l\xf2ng th\u1eed l\u1ea1i!")},onCancel:()=>{H(!1),B(5),E("")},okText:"G\u1eedi",cancelText:"H\u1ee7y",okButtonProps:{disabled:k},confirmLoading:k,children:(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-lg font-medium text-gray-700",children:"\u0110\xe1nh gi\xe1:"}),(0,m.jsx)("input",{type:"number",value:M,onChange:e=>B(e.target.value),min:1,max:5,className:"w-full border border-gray-300 rounded-lg p-2 mt-2",placeholder:"Nh\u1eadp t\u1eeb 1 \u0111\u1ebfn 5 sao"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-lg font-medium text-gray-700",children:"Nh\u1eadn x\xe9t:"}),(0,m.jsx)("textarea",{value:R,onChange:e=>E(e.target.value),rows:4,className:"w-full border border-gray-300 rounded-lg p-2 mt-2",placeholder:"H\xe3y vi\u1ebft c\u1ea3m nh\u1eadn c\u1ee7a b\u1ea1n..."})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-lg font-medium text-gray-700",children:"H\xecnh \u1ea3nh:"}),(0,m.jsx)("input",{type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files);A((e=>({...e,images:t})))},className:"w-full border border-gray-300 rounded-lg p-2 mt-2"}),(0,m.jsx)("div",{className:"image-preview mt-4 grid grid-cols-3 gap-4",children:(null===O||void 0===O?void 0:O.images)&&O.images.map(((e,t)=>(0,m.jsx)("img",{src:URL.createObjectURL(e),alt:`Preview ${t}`,className:"w-full h-20 object-cover rounded-lg shadow-sm"},t)))})]})]})}),(0,m.jsx)(c.A,{open:V.open,onClose:()=>{_((e=>({...e,open:!1})))},severity:V.severity,message:V.message})]})}}}]);
//# sourceMappingURL=922.f41186dc.chunk.js.map