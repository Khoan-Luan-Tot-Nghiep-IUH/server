{"version":3,"file":"static/js/922.f41186dc.chunk.js","mappings":"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","sources":["components/Orders/TicketBookingPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useGetBookingHistoryQuery, useCancelBookingMutation } from '../../Redux/Booking/bookingApiSlice';\r\nimport { useCreateCompanyFeedbackMutation } from '../../Redux/User/apiSlice';\r\nimport { MdLocationOn, MdDateRange, MdChair, MdConfirmationNumber } from 'react-icons/md';\r\nimport Notification from '../shared/Notification/Notification';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { Modal, Button } from 'antd';\r\nimport { FaCalendarAlt, FaMoneyBillAlt } from 'react-icons/fa';\r\nimport './loading-overlay.css';\r\nconst ITEMS_PER_PAGE = 5;\r\n\r\nconst TicketBookingPage = () => {\r\n  const [groupedBookings, setGroupedBookings] = useState([]);\r\n  const [bookingCounts, setBookingCounts] = useState({ current: 0, completed: 0, canceled: 0 });\r\n  const [activeTab, setActiveTab] = useState('current');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const { data, isLoading, isError, refetch } = useGetBookingHistoryQuery();\r\n  const [cancelBooking] = useCancelBookingMutation();\r\n  const location = useLocation();\r\n  const [loading, setLoading] = useState(false);\r\n  const [modalVisible, setModalVisible] = useState(false);\r\n  const [modalData, setModalData] = useState(null);\r\n\r\n\r\n  const [reviewModalVisible, setReviewModalVisible] = useState(false);\r\n  const [reviewBooking, setReviewBooking] = useState(null);\r\n  const [rating, setRating] = useState(5);\r\n  const [comment, setComment] = useState('');\r\n  const [submitReview] = useCreateCompanyFeedbackMutation();\r\n\r\n  const handleReview = (booking) => {\r\n    setReviewBooking(booking);\r\n    setReviewModalVisible(true);\r\n  };\r\n  const handleImageChange = (event) => {\r\n    const files = Array.from(event.target.files);\r\n    setReviewBooking((prev) => ({\r\n      ...prev,\r\n      images: files,\r\n    }));\r\n  };\r\n  \r\n  const handleReviewSubmit = async () => {\r\n    if (!reviewBooking || !reviewBooking.trip?.companyId) {\r\n      showNotification('error', 'Không thể đánh giá. Vui lòng thử lại!');\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n\r\n      const formData = new FormData();\r\n      formData.append('companyId', reviewBooking.trip.companyId._id || reviewBooking.trip.companyId);\r\n      formData.append('rating', rating);\r\n      formData.append('comment', comment);\r\n\r\n      if (reviewBooking.images && reviewBooking.images.length > 0) {\r\n        reviewBooking.images.forEach((file) => {\r\n          formData.append('images', file);\r\n        });\r\n      }\r\n  \r\n      // Gửi FormData qua mutation\r\n      await submitReview(formData).unwrap();\r\n      setReviewModalVisible(false);\r\n      setRating(5);\r\n      setComment('');\r\n      showNotification('success', 'Đánh giá thành công!');\r\n      refetch();\r\n    } catch (error) {\r\n      showNotification('error', `Lỗi khi đánh giá: ${error.message}`);\r\n    }\r\n    finally {\r\n      setLoading(false); \r\n    }\r\n  };\r\n  \r\n\r\n  const handleReviewCancel = () => {\r\n    setReviewModalVisible(false);\r\n    setRating(5);\r\n    setComment('');\r\n  };\r\n\r\n\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(location.search);\r\n    const success = params.get('success');\r\n    const message = params.get('message');\r\n    if (success === 'true' && message) {\r\n      setNotification({\r\n        open: true,\r\n        severity: 'success',\r\n        message,\r\n      });\r\n    }\r\n  }, [location]);\r\n\r\n\r\n  useEffect(() => {\r\n    if (location.state) {\r\n        const { orderCode, trip, seatNumbers, totalPrice, paymentMethod } = location.state;\r\n        setModalData({\r\n            orderCode,\r\n            trip,\r\n            seatNumbers,\r\n            totalPrice,\r\n            paymentMethod,\r\n        });\r\n        setModalVisible(true);\r\n    }\r\n}, [location]);\r\n\r\nconst handleModalClose = () => {\r\n  setModalVisible(false);\r\n};\r\n\r\n\r\n  const [notification, setNotification] = useState({\r\n    open: false,\r\n    severity: 'info',\r\n    message: '',\r\n  });\r\n\r\n  const showNotification = (severity, message) => {\r\n    setNotification({ open: true, severity, message });\r\n  };\r\n\r\n  const handleNotificationClose = () => {\r\n    setNotification((prev) => ({ ...prev, open: false }));\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (data?.success) {\r\n      const bookingsByStatus = data.data.reduce((acc, booking) => {\r\n        const date = new Date(booking.bookingDate).toLocaleDateString();\r\n  \r\n        let statusGroup;\r\n        if (booking.trip?.status === 'Scheduled' && booking.status === 'Confirmed') {\r\n          statusGroup = 'current';\r\n        } else if (booking.trip?.status === 'Completed' && booking.status === 'Confirmed') {\r\n          statusGroup = 'completed';\r\n        } else if (booking.status === 'Cancelled') {\r\n          statusGroup = 'canceled';\r\n        }\r\n\r\n        if (statusGroup) {\r\n          if (!acc[statusGroup]) acc[statusGroup] = {};\r\n          if (!acc[statusGroup][date]) acc[statusGroup][date] = [];\r\n          acc[statusGroup][date].push(booking);\r\n        }\r\n\r\n        return acc;\r\n      }, {});\r\n\r\n      setGroupedBookings(bookingsByStatus);\r\n\r\n      setBookingCounts({\r\n        current: bookingsByStatus.current ? Object.values(bookingsByStatus.current).flat().length : 0,\r\n        completed: bookingsByStatus.completed ? Object.values(bookingsByStatus.completed).flat().length : 0,\r\n        canceled: bookingsByStatus.canceled ? Object.values(bookingsByStatus.canceled).flat().length : 0,\r\n      });\r\n    }\r\n  }, [data]);\r\n\r\n  const handlePageChange = (page) => {\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  const handleNextPage = () => {\r\n    setCurrentPage((prevPage) => prevPage + 1);\r\n  };\r\n\r\n  const handlePrevPage = () => {\r\n    setCurrentPage((prevPage) => Math.max(prevPage - 1, 1));\r\n  };\r\n\r\n  const handleCancelBooking = async (bookingId) => {\r\n    try {\r\n      await cancelBooking(bookingId).unwrap();\r\n      showNotification('success', 'Hủy vé thành công!');\r\n      refetch();\r\n    } catch (error) {\r\n      showNotification('error', `Lỗi khi hủy vé: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  if (isLoading) return <p>Loading...</p>;\r\n  if (isError || !data?.success)\r\n    return (\r\n      <div className=\"container mx-auto mt-10 bg-white shadow-md rounded-lg p-8\">\r\n        <p>\r\n          Bạn chưa có lịch sử đặt vé nào. <a href=\"/\" className=\"text-blue-600\">Đặt vé ngay!</a>\r\n        </p>\r\n      </div>\r\n    );\r\n\r\n  const renderBookings = (tab) => {\r\n    const bookingsList = groupedBookings[tab];\r\n    if (!bookingsList || Object.keys(bookingsList).length === 0) {\r\n      return (\r\n        <p className=\"text-gray-600\">\r\n          {tab === 'current'\r\n            ? \"Bạn chưa có chuyến sắp đi nào. \"\r\n            : tab === 'completed'\r\n            ? \"Bạn chưa có chuyến nào đã hoàn thành.\"\r\n            : \"Bạn chưa có vé nào đã hủy.\"}\r\n          {tab === 'current' && <a href=\"/book\" className=\"text-blue-600\">Đặt chuyến đi ngay!</a>}\r\n        </p>\r\n        \r\n      );\r\n    }\r\n\r\n    const groupedBookingsArray = Object.entries(bookingsList);\r\n    const totalPages = Math.ceil(groupedBookingsArray.length / ITEMS_PER_PAGE);\r\n    const paginatedGroupedBookings = groupedBookingsArray.slice(\r\n      (currentPage - 1) * ITEMS_PER_PAGE,\r\n      currentPage * ITEMS_PER_PAGE\r\n    );\r\n\r\n    return (\r\n      <>\r\n        {paginatedGroupedBookings.map(([date, bookings]) => (\r\n          <div key={date} className=\"mb-8\">\r\n            <h3 className=\"text-lg font-semibold text-gray-700 mb-4\">{date}</h3>\r\n            {bookings.map((booking) => (\r\n              <BookingCard key={booking._id} booking={booking}  activeTab={activeTab} onCancel={handleCancelBooking}  onReview={handleReview} />\r\n            ))}\r\n            \r\n          </div>\r\n        ))}\r\n        <Pagination\r\n          totalPages={totalPages}\r\n          currentPage={currentPage}\r\n          onPageChange={handlePageChange}\r\n          onNextPage={handleNextPage}\r\n          onPrevPage={handlePrevPage}\r\n        />\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto mt-10 bg-white shadow-md rounded-lg p-8\">\r\n      <div className=\"border-b border-gray-300 mb-6\">\r\n        <nav className=\"flex justify-center space-x-8\">\r\n          {['current', 'completed', 'canceled'].map((tab) => (\r\n            <button\r\n              key={tab}\r\n              onClick={() => {\r\n                setActiveTab(tab);\r\n                setCurrentPage(1);\r\n              }}\r\n              className={`py-3 px-4 text-lg font-semibold ${\r\n                activeTab === tab ? 'text-blue-600 border-b-2 border-blue-500' : 'text-gray-600'\r\n              }`}\r\n            >\r\n              {tab === 'current'\r\n                ? `Hiện tại (${bookingCounts.current})`\r\n                : tab === 'completed'\r\n                ? `Đã đi (${bookingCounts.completed})`\r\n                : `Đã hủy (${bookingCounts.canceled})`}\r\n            </button>\r\n          ))}\r\n        </nav>\r\n      </div>\r\n      <div>{renderBookings(activeTab)}</div>\r\n      <Modal\r\n                title=\"Thông Tin Đơn Hàng\"\r\n                visible={modalVisible}\r\n                onOk={handleModalClose}\r\n                onCancel={handleModalClose}\r\n                okText=\"Xác nhận\"\r\n                cancelText=\"Đóng\"\r\n            >\r\n                {modalData && (\r\n                <div className=\"space-y-8 text-gray-700\">\r\n                  <div className=\"flex items-center\">\r\n                    <p className=\"font-medium text-gray-500 mr-2\">Mã đơn hàng:</p>\r\n                    <p className=\"text-lg font-semibold\">{modalData.orderCode}</p>\r\n                  </div>\r\n                  <div className=\"flex items-center\">\r\n                    <MdChair className=\"text-blue-500 mr-2\" />\r\n                    <p className=\"font-medium text-gray-500 mr-2\">Ghế:</p>\r\n                    <p className=\"text-lg font-semibold\">{modalData.seatNumbers.join(', ')}</p>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center\">\r\n                    <FaMoneyBillAlt className=\"text-green-500 mr-2\" />\r\n                    <p className=\"font-medium text-gray-500 mr-2\">Tổng tiền:</p>\r\n                    <p className=\"text-lg font-bold text-green-600\">{modalData.totalPrice.toLocaleString()} VND</p>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center\">\r\n                    <FaCalendarAlt className=\"text-gray-500 mr-2\" />\r\n                    <p className=\"font-medium text-gray-500 mr-2\">Phương thức thanh toán:</p>\r\n                    <p className=\"text-lg font-semibold\">\r\n                      {modalData.paymentMethod === 'OnBoard' ? 'Thanh toán khi lên xe' : 'Thanh toán online'}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </Modal>\r\n\r\n\r\n            <Modal\r\n  title={\r\n    <div className=\"modal-header\">\r\n      <h2 className=\"text-xl font-bold text-blue-600\">Đánh giá chuyến đi</h2>\r\n    </div>\r\n  }\r\n  visible={reviewModalVisible}\r\n  onOk={handleReviewSubmit}\r\n  onCancel={handleReviewCancel}\r\n  okText=\"Gửi\"\r\n  cancelText=\"Hủy\"\r\n  okButtonProps={{ disabled: loading }}\r\n  confirmLoading={loading}\r\n>\r\n  <div className=\"space-y-6\">\r\n    {/* Đánh giá sao */}\r\n    <div>\r\n      <p className=\"text-lg font-medium text-gray-700\">Đánh giá:</p>\r\n      <input\r\n        type=\"number\"\r\n        value={rating}\r\n        onChange={(e) => setRating(e.target.value)}\r\n        min={1}\r\n        max={5}\r\n        className=\"w-full border border-gray-300 rounded-lg p-2 mt-2\"\r\n        placeholder=\"Nhập từ 1 đến 5 sao\"\r\n      />\r\n    </div>\r\n\r\n    {/* Nhận xét */}\r\n    <div>\r\n      <p className=\"text-lg font-medium text-gray-700\">Nhận xét:</p>\r\n      <textarea\r\n        value={comment}\r\n        onChange={(e) => setComment(e.target.value)}\r\n        rows={4}\r\n        className=\"w-full border border-gray-300 rounded-lg p-2 mt-2\"\r\n        placeholder=\"Hãy viết cảm nhận của bạn...\"\r\n      />\r\n    </div>\r\n\r\n    {/* Khu vực tải ảnh */}\r\n    <div>\r\n      <p className=\"text-lg font-medium text-gray-700\">Hình ảnh:</p>\r\n      <input\r\n        type=\"file\"\r\n        multiple\r\n        onChange={handleImageChange}\r\n        className=\"w-full border border-gray-300 rounded-lg p-2 mt-2\"\r\n      />\r\n      <div className=\"image-preview mt-4 grid grid-cols-3 gap-4\">\r\n        {reviewBooking?.images &&\r\n          reviewBooking.images.map((file, index) => (\r\n            <img\r\n              key={index}\r\n              src={URL.createObjectURL(file)}\r\n              alt={`Preview ${index}`}\r\n              className=\"w-full h-20 object-cover rounded-lg shadow-sm\"\r\n            />\r\n          ))}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</Modal>\r\n      <Notification\r\n        open={notification.open}\r\n        onClose={handleNotificationClose}\r\n        severity={notification.severity}\r\n        message={notification.message}\r\n      />\r\n    </div>\r\n  );\r\n  };\r\n\r\nconst BookingCard = ({ booking, onCancel , onReview , activeTab }) => {\r\n  const departureLocation = booking.trip?.departureLocation?.name || 'N/A';\r\n  const arrivalLocation = booking.trip?.arrivalLocation?.name || 'N/A';\r\n  const departureTime = booking.trip?.departureTime ? new Date(booking.trip.departureTime) : null;\r\n\r\n  return (\r\n    <div className=\"bg-gray-50 shadow-lg rounded-lg p-6 mb-4 transition-transform transform hover:scale-105\">\r\n      <div className=\"flex justify-between items-start\">\r\n        <div>\r\n          <h3 className=\"text-xl font-semibold text-gray-800 flex items-center\">\r\n            <MdLocationOn className=\"text-blue-500 mr-2\" />\r\n            {departureLocation} → {arrivalLocation}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-600 flex items-center mt-1\">\r\n            <MdDateRange className=\"text-blue-500 mr-2\" />\r\n            {departureTime ? `${departureTime.toLocaleDateString()} - ${departureTime.toLocaleTimeString()}` : 'Thời gian không có sẵn'}\r\n          </p>\r\n        </div>\r\n        <span className={`px-3 py-1 text-xs rounded-full font-semibold ${\r\n          booking.status === 'Confirmed' ? 'bg-green-100 text-green-600' :\r\n          booking.status === 'Completed' ? 'bg-blue-100 text-blue-600' : 'bg-red-100 text-red-600'\r\n        }`}>\r\n          {booking.status}\r\n        </span>\r\n      </div>\r\n      <div className=\"mt-4 flex justify-between items-center\">\r\n        <div>\r\n          <div className=\"flex items-center text-gray-700 mb-2\">\r\n            <MdChair className=\"text-blue-500 mr-2\" />\r\n            <span className=\"font-semibold\">Ghế:</span> {booking.seatNumbers.join(', ')}\r\n          </div>\r\n          <div className=\"flex items-center text-gray-700 mb-2\">\r\n            <span className=\"text-blue-500 mr-2\">💲</span>\r\n            <span className=\"font-semibold\">Giá vé:</span> {booking.totalPrice.toLocaleString()} VND\r\n          </div>\r\n          <div className=\"flex items-center text-gray-700\">\r\n            <MdConfirmationNumber className=\"text-blue-500 mr-2\" />\r\n            <span className=\"font-semibold\">Mã đặt vé:</span> {booking.orderCode}\r\n          </div>\r\n        </div>\r\n        {booking.status === 'Confirmed' && activeTab !== 'completed' && (\r\n          <button\r\n            onClick={() => onCancel(booking._id)}\r\n            className=\"bg-red-500 text-white px-4 py-2 rounded-lg\"\r\n          >\r\n            Hủy vé\r\n          </button>\r\n        )}\r\n        {activeTab === 'completed' && (\r\n          <button\r\n            onClick={() => onReview(booking)}\r\n            className=\"bg-yellow-500 text-white px-4 py-2 rounded-lg\"\r\n          >\r\n            Đánh giá\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Pagination = ({ totalPages, currentPage, onPageChange, onNextPage, onPrevPage }) => {\r\n  return (\r\n    <div className=\"flex justify-center mt-6 space-x-2\">\r\n      <button\r\n        onClick={onPrevPage}\r\n        disabled={currentPage === 1}\r\n        className={`px-3 py-1 rounded-lg ${currentPage === 1 ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 text-white'}`}\r\n      >\r\n        Quay lại\r\n      </button>\r\n      {[...Array(totalPages).keys()].map((page) => (\r\n        <button\r\n          key={page + 1}\r\n          onClick={() => onPageChange(page + 1)}\r\n          className={`px-3 py-1 rounded-lg ${\r\n            page + 1 === currentPage ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'\r\n          }`}\r\n        >\r\n          {page + 1}\r\n        </button>\r\n      ))}\r\n      <button\r\n        onClick={onNextPage}\r\n        disabled={currentPage === totalPages}\r\n        className={`px-3 py-1 rounded-lg ${currentPage === totalPages ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 text-white'}`}\r\n      >\r\n        Trang tiếp\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TicketBookingPage;\r\n"],"names":["BookingCard","_ref2","_booking$trip3","_booking$trip3$depart","_booking$trip4","_booking$trip4$arriva","_booking$trip5","booking","onCancel","onReview","activeTab","departureLocation","trip","name","arrivalLocation","departureTime","Date","_jsxs","className","children","_jsx","MdLocationOn","MdDateRange","toLocaleDateString","toLocaleTimeString","status","MdChair","seatNumbers","join","totalPrice","toLocaleString","MdConfirmationNumber","orderCode","onClick","_id","Pagination","_ref3","totalPages","currentPage","onPageChange","onNextPage","onPrevPage","disabled","Array","keys","map","page","TicketBookingPage","groupedBookings","setGroupedBookings","useState","bookingCounts","setBookingCounts","current","completed","canceled","setActiveTab","setCurrentPage","data","isLoading","isError","refetch","useGetBookingHistoryQuery","cancelBooking","useCancelBookingMutation","location","useLocation","loading","setLoading","modalVisible","setModalVisible","modalData","setModalData","reviewModalVisible","setReviewModalVisible","reviewBooking","setReviewBooking","rating","setRating","comment","setComment","submitReview","useCreateCompanyFeedbackMutation","handleReview","useEffect","params","URLSearchParams","search","success","get","message","setNotification","open","severity","state","paymentMethod","handleModalClose","notification","showNotification","bookingsByStatus","reduce","acc","_booking$trip","_booking$trip2","date","bookingDate","statusGroup","push","Object","values","flat","length","handlePageChange","handleNextPage","prevPage","handlePrevPage","Math","max","handleCancelBooking","async","bookingId","unwrap","error","href","tab","bookingsList","groupedBookingsArray","entries","ceil","paginatedGroupedBookings","slice","_Fragment","_ref","bookings","renderBookings","Modal","title","visible","onOk","okText","cancelText","FaMoneyBillAlt","FaCalendarAlt","_reviewBooking$trip","companyId","formData","FormData","append","images","forEach","file","handleReviewCancel","okButtonProps","confirmLoading","type","value","onChange","e","target","min","placeholder","rows","multiple","event","files","from","prev","index","src","URL","createObjectURL","alt","Notification","onClose","handleNotificationClose"],"sourceRoot":""}