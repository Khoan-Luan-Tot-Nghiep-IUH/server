{"version":3,"file":"static/js/191.76c0aee8.chunk.js","mappings":"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","sources":["components/auth/sidebar/OffersPage.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { useGetAllVouchersQuery, useRedeemPointsForVoucherMutation } from '../../../Redux/User/apiSlice';\r\nimport { FaGift, FaCheckCircle, FaTimesCircle } from 'react-icons/fa';\r\nimport { GiTwoCoins } from 'react-icons/gi';\r\nimport { Modal, Spin, message } from 'antd';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst OffersPage = () => {\r\n  const userInfo = useSelector((state) => state.user.userInfo); // Lấy thông tin user từ Redux\r\n  const navigate = useNavigate();\r\n  const { data: vouchers, error, isLoading, refetch } = useGetAllVouchersQuery(undefined, {\r\n    skip: !userInfo, // Bỏ qua query nếu chưa đăng nhập\r\n  });\r\n  const [redeemPointsForVoucher, { isLoading: isRedeeming }] = useRedeemPointsForVoucherMutation();\r\n  const [points, setPoints] = useState('');\r\n  const [modalVisible, setModalVisible] = useState(!userInfo); // Mở modal nếu chưa đăng nhập\r\n  const [currentVoucher, setCurrentVoucher] = useState(null);\r\n\r\n  const handleRedeem = async () => {\r\n    if (!points || points <= 0 || isNaN(points)) {\r\n      message.error('Vui lòng nhập số điểm hợp lệ để đổi.');\r\n      return;\r\n    }\r\n    try {\r\n      const response = await redeemPointsForVoucher({ points: parseInt(points) }).unwrap();\r\n      message.success(`Đổi điểm thành công! Bạn đã nhận được voucher giảm ${response.voucher.discount}%`);\r\n      setPoints(''); // Reset điểm sau khi đổi thành công\r\n      refetch(); // Cập nhật danh sách voucher sau khi đổi điểm\r\n    } catch (error) {\r\n      message.error(error?.data?.message || 'Lỗi khi đổi điểm lấy voucher.');\r\n    }\r\n  };\r\n\r\n  const handleModalOk = () => {\r\n    setModalVisible(false);\r\n    navigate('/login'); // Chuyển hướng về trang đăng nhập\r\n  };\r\n\r\n  const handleModalCancel = () => {\r\n    setModalVisible(false);\r\n    navigate('/'); // Chuyển hướng về trang chủ\r\n  };\r\n\r\n  if (!userInfo) {\r\n    return (\r\n      <Modal\r\n        title=\"Chưa đăng nhập\"\r\n        visible={modalVisible}\r\n        onOk={handleModalOk}\r\n        onCancel={handleModalCancel}\r\n        okText=\"Đăng nhập\"\r\n        cancelText=\"Quay lại trang chủ\"\r\n      >\r\n        <p>Bạn cần đăng nhập để sử dụng các ưu đãi. Hãy đăng nhập hoặc quay lại trang chủ.</p>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-3xl mx-auto p-4 sm:p-8\">\r\n      <h2 className=\"text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-4 sm:mb-6\">Ưu Đãi & Voucher</h2>\r\n\r\n      {/* Hiển thị điểm thưởng */}\r\n      <div className=\"text-center bg-blue-100 text-blue-700 font-semibold rounded-lg p-4 mb-6\">\r\n        Bạn có <span className=\"text-blue-900 font-bold\">{userInfo?.loyaltyPoints || 0}</span> điểm thưởng.\r\n      </div>\r\n\r\n      {/* Form đổi điểm lấy voucher */}\r\n      <div className=\"bg-purple-100 rounded-lg p-4 sm:p-6 shadow-lg mb-6 sm:mb-8\">\r\n        <h3 className=\"text-lg sm:text-xl font-semibold text-gray-800 mb-3 sm:mb-4 flex items-center\">\r\n          <GiTwoCoins className=\"text-yellow-500 mr-2\" /> Đổi Điểm Lấy Voucher\r\n        </h3>\r\n        <div className=\"flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-4\">\r\n          <input\r\n            type=\"number\"\r\n            value={points}\r\n            onChange={(e) => setPoints(e.target.value.trim())}\r\n            placeholder=\"Nhập số điểm\"\r\n            className=\"w-full sm:w-auto flex-1 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500\"\r\n          />\r\n          <button\r\n            onClick={handleRedeem}\r\n            disabled={isRedeeming}\r\n            className={`w-full sm:w-auto bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ${\r\n              isRedeeming ? 'cursor-not-allowed opacity-50' : 'hover:bg-purple-700'\r\n            }`}\r\n          >\r\n            {isRedeeming ? 'Đang đổi...' : 'Đổi Điểm'}\r\n          </button>\r\n        </div>\r\n        <p className=\"text-gray-600 mt-3 text-center sm:text-left\">100 điểm = voucher giảm 10%</p>\r\n      </div>\r\n\r\n      {/* Danh sách voucher */}\r\n      <div className=\"bg-white rounded-lg p-4 sm:p-6 shadow-lg\">\r\n        <h3 className=\"text-lg sm:text-xl font-semibold text-gray-800 mb-3 sm:mb-4 flex items-center\">\r\n          <FaGift className=\"text-red-500 mr-2\" /> Voucher Của Bạn\r\n        </h3>\r\n\r\n        {isLoading ? (\r\n          <div className=\"flex justify-center\">\r\n            <Spin size=\"large\" />\r\n          </div>\r\n        ) : error ? (\r\n          <p className=\"text-center text-red-500\">Lỗi khi tải danh sách voucher</p>\r\n        ) : vouchers && vouchers.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6\">\r\n            {vouchers.map((voucher) => (\r\n              <div\r\n                key={voucher._id}\r\n                className=\"border p-4 rounded-lg shadow-sm flex items-center space-x-4 cursor-pointer\"\r\n                onClick={() => setCurrentVoucher(voucher)}\r\n              >\r\n                <FaGift className=\"text-2xl text-purple-600\" />\r\n                <div>\r\n                  <h4 className=\"text-lg font-semibold text-gray-800\">Mã: {voucher.code}</h4>\r\n                  <p className=\"text-gray-600\">Giảm giá: {voucher.discount}%</p>\r\n                  <p className=\"text-gray-600\">\r\n                    Hạn sử dụng: {new Date(voucher.expiryDate).toLocaleDateString()}\r\n                  </p>\r\n                  <p className=\"flex items-center\">\r\n                    {voucher.isUsed ? (\r\n                      <FaCheckCircle className=\"text-green-500 mr-1\" />\r\n                    ) : (\r\n                      <FaTimesCircle className=\"text-red-500 mr-1\" />\r\n                    )}\r\n                    {voucher.isUsed ? 'Đã sử dụng' : 'Chưa sử dụng'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-center text-gray-500\">Không có voucher nào.</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OffersPage;\r\n"],"names":["OffersPage","userInfo","useSelector","state","user","navigate","useNavigate","data","vouchers","error","isLoading","refetch","useGetAllVouchersQuery","undefined","skip","redeemPointsForVoucher","isRedeeming","useRedeemPointsForVoucherMutation","points","setPoints","useState","modalVisible","setModalVisible","currentVoucher","setCurrentVoucher","handleModalOk","handleModalCancel","_jsxs","className","children","_jsx","loyaltyPoints","GiTwoCoins","type","value","onChange","e","target","trim","placeholder","onClick","async","isNaN","message","response","parseInt","unwrap","success","voucher","discount","_error$data","disabled","FaGift","Spin","size","length","map","code","Date","expiryDate","toLocaleDateString","isUsed","FaCheckCircle","FaTimesCircle","_id","Modal","title","visible","onOk","onCancel","okText","cancelText"],"sourceRoot":""}