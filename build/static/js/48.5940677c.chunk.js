"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[48],{64048:(e,i,t)=>{t.r(i),t.d(i,{default:()=>M});var n=t(65043),r=t(83003),a=t(65868),s=t(35475),l=t(62764),o=t(67290),c=t(96651),d=t(3188),m=t(40322),u=t(90696),h=t(91995),p=t(91686),x=t(94434),v=t(75995),g=t(60184),y=t(10254),f=t(34348),b=t.n(f),j=t(70579);const T=e=>{let{trips:i,openDrawer:t,hideAddButton:f,refetch:T}=e;const N=(0,r.wA)(),[k]=(0,a.tJ)(),[C]=(0,a.E8)(),[w,P]=(0,n.useState)({open:!1,severity:"",message:""}),[A,I]=(0,n.useState)(null),[L,D]=(0,n.useState)(!1),[S,_]=(0,n.useState)([]),{data:O,isLoading:H}=(0,l.BI)(),F=(e,i)=>{P({open:!0,severity:e,message:i})},q=[{title:"\u0110i\u1ec3m kh\u1edfi h\xe0nh",dataIndex:["departureLocation","name"],key:"departureLocation"},{title:"\u0110i\u1ec3m \u0111\u1ebfn",dataIndex:["arrivalLocation","name"],key:"arrivalLocation"},{title:"Lo\u1ea1i xe",dataIndex:["busType","name"],key:"busType",render:e=>(0,j.jsx)("span",{className:"bg-green-200 text-green-800 px-2 py-1 rounded-full",children:e})},{title:"Th\u1eddi gian kh\u1edfi h\xe0nh",dataIndex:"departureTime",key:"departureTime",render:e=>y.D.formatDisplayTime(e)},{title:"Th\u1eddi gian \u0111\u1ebfn",dataIndex:"arrivalTime",key:"arrivalTime",render:e=>y.D.formatDisplayTime(e)},{title:"Gi\xe1 v\xe9",dataIndex:"basePrice",key:"basePrice",render:e=>(0,y.v)(e)},{title:"T\xe0i x\u1ebf",dataIndex:"drivers",key:"drivers",render:e=>e&&e.length>0?e.map((e=>(0,j.jsx)("span",{className:"block",children:e.fullName?`${e.fullName} (Driver)`:"Th\xf4ng tin kh\xf4ng x\xe1c \u0111\u1ecbnh"},e._id))):(0,j.jsx)("span",{className:"text-rose-400",children:"Ch\u01b0a c\xf3 t\xe0i x\u1ebf"})},{title:"Thao t\xe1c",key:"action",render:(e,n)=>{const r=n.drivers&&n.drivers.length>0;return(0,j.jsxs)("div",{className:"flex space-x-2",children:[(0,j.jsx)(c.A,{title:"Chi ti\u1ebft",children:(0,j.jsx)(s.N_,{to:`/trips/${n._id}`,className:"text-blue-500 hover:text-blue-700",children:(0,j.jsx)(g.Ny1,{className:"inline mr-1 text-lg align-middle"})})}),(0,j.jsx)(c.A,{title:"S\u1eeda",children:(0,j.jsx)(d.Ay,{type:"link",className:"text-yellow-500 hover:text-yellow-700",onClick:()=>(e=>{const i={...e,departureTime:b().utc(e.departureTime).toISOString(),arrivalTime:b().utc(e.arrivalTime).toISOString()};t(i)})(n),children:(0,j.jsx)(g.uO9,{className:"inline mr-1 text-lg align-middle"})})}),!r&&(0,j.jsx)(c.A,{title:"Th\xeam t\xe0i x\u1ebf",children:(0,j.jsx)(d.Ay,{type:"link",className:"text-green-500 hover:text-green-700",onClick:()=>(I(n),void D(!0)),children:(0,j.jsx)(g.NPy,{className:"inline mr-1 text-lg align-middle"})})}),(0,j.jsx)(c.A,{title:"X\xf3a",children:(0,j.jsx)(m.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a chuy\u1ebfn \u0111i n\xe0y kh\xf4ng?",onConfirm:()=>(async e=>{try{await k(e).unwrap(),N((0,o.gg)("X\xf3a chuy\u1ebfn \u0111i th\xe0nh c\xf4ng."));const t=i.filter((i=>i._id!==e));N((0,o.hO)(t)),F("success","X\xf3a chuy\u1ebfn \u0111i th\xe0nh c\xf4ng."),T()}catch(t){N((0,o.Nh)("L\u1ed7i khi x\xf3a chuy\u1ebfn \u0111i: "+t.message)),F("error",`L\u1ed7i khi x\xf3a chuy\u1ebfn \u0111i: ${t.message}`)}})(n._id),okText:"C\xf3",cancelText:"Kh\xf4ng",children:(0,j.jsx)(d.Ay,{type:"link",className:"text-red-500 hover:text-red-700",children:(0,j.jsx)(g.qbC,{className:"inline mr-1 text-lg align-middle"})})})})]})}}];return(0,j.jsxs)("div",{className:"p-4",children:[(0,j.jsx)(u.A,{columns:q,dataSource:i,rowKey:e=>e._id,pagination:!1,bordered:!0,className:"bg-white shadow-md rounded-lg overflow-hidden"}),(0,j.jsx)(v.A,{open:w.open,severity:w.severity,message:w.message,onClose:()=>P({...w,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"}}),(0,j.jsx)(h.A,{title:"Th\xeam t\xe0i x\u1ebf",visible:L,onOk:async()=>{if(S.length)try{await C({tripId:A._id,driverIds:S}).unwrap(),F("success","Th\xeam t\xe0i x\u1ebf th\xe0nh c\xf4ng."),D(!1),T()}catch(t){var e,i;const n=(null===(e=t.data)||void 0===e?void 0:e.message)||"L\u1ed7i khi th\xeam t\xe0i x\u1ebf.",r=(null===(i=t.data)||void 0===i?void 0:i.conflictingDrivers)||[],a=r.length?`C\xe1c t\xe0i x\u1ebf g\xe2y xung \u0111\u1ed9t: ${r.join(", ")}`:"";F("error",`${n} ${a}`)}else F("error","B\u1ea1n ph\u1ea3i ch\u1ecdn \xedt nh\u1ea5t m\u1ed9t t\xe0i x\u1ebf")},onCancel:()=>D(!1),children:H?(0,j.jsx)(p.A,{}):O&&Array.isArray(O.drivers)&&O.drivers.length>0?(0,j.jsx)(x.A,{mode:"multiple",style:{width:"100%"},placeholder:"Ch\u1ecdn t\xe0i x\u1ebf",onChange:e=>_(e),children:O.drivers.map((e=>{var i;return(0,j.jsx)(x.A.Option,{value:e._id,children:null!==(i=e.userId)&&void 0!==i&&i.fullName?e.userId.fullName:"T\xean kh\xf4ng x\xe1c \u0111\u1ecbnh"},e._id)}))}):(0,j.jsx)("p",{children:"Kh\xf4ng c\xf3 t\xe0i x\u1ebf n\xe0o"})})]})};var N=t(31899),k=t.n(N),C=(t(25015),t(39052)),w=t(90480),P=t(86178),A=t.n(P);const I=e=>{var i,t;let{tripId:s,closeDrawer:l}=e;const{companyId:o}=(0,r.d4)((e=>e.user.userInfo)),[c]=(0,a._w)(),[d]=(0,a.Lr)(),{data:m}=(0,a.pY)(s,{skip:!s}),{data:u,isLoading:h}=(0,C.eg)(),{data:p,isLoading:x,error:v}=(0,w.rz)({companyId:o},{skip:!o}),[g,f]=(0,n.useState)({departureLocation:"",arrivalLocation:"",busType:"",departureTime:new Date,arrivalTime:new Date,basePrice:"",isRoundTrip:!1,pickupPoints:[],dropOffPoints:[]});(0,n.useEffect)((()=>{if(m&&m.data){var e,i,t;const n=m.data.trip;f({departureLocation:(null===n||void 0===n||null===(e=n.departureLocation)||void 0===e?void 0:e._id)||"",arrivalLocation:(null===n||void 0===n||null===(i=n.arrivalLocation)||void 0===i?void 0:i._id)||"",busType:(null===n||void 0===n||null===(t=n.busType)||void 0===t?void 0:t._id)||"",departureTime:y.D.parseUTCTimeForForm(n.departureTime),arrivalTime:y.D.parseUTCTimeForForm(n.arrivalTime),basePrice:null===n||void 0===n?void 0:n.basePrice,isRoundTrip:(null===n||void 0===n?void 0:n.isRoundTrip)||!1,pickupPoints:(null===n||void 0===n?void 0:n.pickupPoints)||[],dropOffPoints:(null===n||void 0===n?void 0:n.dropOffPoints)||[]})}}),[m]);const b=e=>{const{name:i,value:t,type:n,checked:r}=e.target;f({...g,[i]:"checkbox"===n?r:t})},T=(e,i)=>{f({...g,[e]:i})},N=(e,i,t)=>{const n=[...g.pickupPoints];n[e][i]=t,f({...g,pickupPoints:n})},P=(e,i,t)=>{const n=[...g.dropOffPoints];n[e][i]=t,f({...g,dropOffPoints:n})};return(0,j.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=((e,i)=>{const t=A()(e);return i.map(((e,i)=>{const n=15*i;return{...e,time:t.clone().add(n,"minutes").format("HH:mm")}}))})(g.departureTime,g.pickupPoints),i=((e,i)=>{const t=A()(e);return i.map(((e,n)=>{const r=15*(i.length-1-n);return{...e,time:t.clone().subtract(r,"minutes").format("HH:mm")}}))})(g.arrivalTime,g.dropOffPoints),t={...g,pickupPoints:e,dropOffPoints:i,departureTime:y.D.formatTimeForServer(g.departureTime),arrivalTime:y.D.formatTimeForServer(g.arrivalTime),basePrice:parseInt(g.basePrice,10)};s?await d({tripId:s,updatedTrip:t}).unwrap():await c(t).unwrap(),l()}catch(i){console.error("L\u1ed7i khi l\u01b0u chuy\u1ebfn \u0111i:",i)}},className:"p-4 bg-white rounded-lg shadow-lg",children:[(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m Kh\u1edfi H\xe0nh:"}),(0,j.jsxs)("select",{name:"departureLocation",value:g.departureLocation,onChange:b,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,j.jsx)("option",{value:"",children:"Ch\u1ecdn \u0111i\u1ec3m kh\u1edfi h\xe0nh"}),!h&&(null===u||void 0===u||null===(i=u.data)||void 0===i?void 0:i.map((e=>(0,j.jsxs)("option",{value:e._id,children:[e.name," - ",e.city]},e._id))))]})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m \u0110\u1ebfn:"}),(0,j.jsxs)("select",{name:"arrivalLocation",value:g.arrivalLocation,onChange:b,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,j.jsx)("option",{value:"",children:"Ch\u1ecdn \u0111i\u1ec3m \u0111\u1ebfn"}),!h&&(null===u||void 0===u||null===(t=u.data)||void 0===t?void 0:t.map((e=>(0,j.jsxs)("option",{value:e._id,children:[e.name," - ",e.city]},e._id))))]})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Th\u1eddi Gian Kh\u1edfi H\xe0nh:"}),(0,j.jsx)(k(),{selected:g.departureTime,onChange:e=>T("departureTime",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"dd/MM/yyyy HH:mm",className:"mt-2 p-3 border rounded w-full focus:ring focus:ring-blue-500",required:!0})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Th\u1eddi Gian \u0110\u1ebfn:"}),(0,j.jsx)(k(),{selected:g.arrivalTime,onChange:e=>T("arrivalTime",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"dd/MM/yyyy HH:mm",className:"mt-2 p-3 border rounded w-full focus:ring focus:ring-blue-500",required:!0})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m \u0110\xf3n:"}),g.pickupPoints.map(((e,i)=>(0,j.jsxs)("div",{className:"flex items-center mb-2",children:[(0,j.jsx)("input",{type:"text",placeholder:"\u0110\u1ecba \u0111i\u1ec3m",value:e.location,onChange:e=>N(i,"location",e.target.value),className:"mr-2 p-2 border rounded w-2/3 focus:ring focus:ring-green-500",required:!0}),(0,j.jsx)("input",{type:"text",placeholder:"Ghi ch\xfa",value:e.note,onChange:e=>N(i,"note",e.target.value),className:"mr-2 p-2 border rounded w-1/3 focus:ring focus:ring-green-500"}),(0,j.jsx)("button",{type:"button",onClick:()=>(e=>{const i=[...g.pickupPoints];i.splice(e,1),f({...g,pickupPoints:i})})(i),className:"text-red-500 hover:text-red-700",children:"X\xf3a"})]},i))),(0,j.jsx)("button",{type:"button",onClick:()=>{f({...g,pickupPoints:[...g.pickupPoints,{location:"",note:""}]})},className:"mt-2 text-blue-500 hover:text-blue-700",children:"+ Th\xeam \u0110i\u1ec3m \u0110\xf3n"})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m Tr\u1ea3:"}),g.dropOffPoints.map(((e,i)=>(0,j.jsxs)("div",{className:"flex items-center mb-2",children:[(0,j.jsx)("input",{type:"text",placeholder:"\u0110\u1ecba \u0111i\u1ec3m",value:e.location,onChange:e=>P(i,"location",e.target.value),className:"mr-2 p-2 border rounded w-2/3 focus:ring focus:ring-green-500",required:!0}),(0,j.jsx)("input",{type:"text",placeholder:"Ghi ch\xfa",value:e.note,onChange:e=>P(i,"note",e.target.value),className:"mr-2 p-2 border rounded w-1/3 focus:ring focus:ring-green-500"}),(0,j.jsx)("button",{type:"button",onClick:()=>(e=>{const i=[...g.dropOffPoints];i.splice(e,1),f({...g,dropOffPoints:i})})(i),className:"text-red-500 hover:text-red-700",children:"X\xf3a"})]},i))),(0,j.jsx)("button",{type:"button",onClick:()=>{f({...g,dropOffPoints:[...g.dropOffPoints,{location:"",note:""}]})},className:"mt-2 text-blue-500 hover:text-blue-700",children:"+ Th\xeam \u0110i\u1ec3m Tr\u1ea3"})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Lo\u1ea1i Xe:"}),x?(0,j.jsx)("p",{children:"\u0110ang t\u1ea3i danh s\xe1ch lo\u1ea1i xe..."}):v?(0,j.jsxs)("p",{className:"text-red-500",children:["L\u1ed7i khi t\u1ea3i danh s\xe1ch lo\u1ea1i xe: ",v.message]}):(0,j.jsxs)("select",{name:"busType",value:g.busType,onChange:b,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,j.jsx)("option",{value:"",children:"Ch\u1ecdn lo\u1ea1i xe"}),null===p||void 0===p?void 0:p.data.map((e=>(0,j.jsx)("option",{value:e._id,children:e.name},e._id)))]})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Gi\xe1 V\xe9 C\u01a1 B\u1ea3n:"}),(0,j.jsx)("input",{type:"number",name:"basePrice",value:g.basePrice,onChange:b,placeholder:"Nh\u1eadp gi\xe1 v\xe9 c\u01a1 b\u1ea3n",className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0}),(0,j.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["Gi\xe1 v\xe9: ",(0,y.v)(g.basePrice)]})]}),(0,j.jsx)("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded w-full",children:s?"C\u1eadp Nh\u1eadt Chuy\u1ebfn \u0110i":"T\u1ea1o Chuy\u1ebfn \u0110i"})]})};var L=t(23927),D=t(8918),S=t(80349),_=t(6051),O=t(42261),H=t(48677);const{Title:F}=L.A,{TabPane:q}=D.A,M=()=>{const e=(0,r.d4)((e=>{var i;return null===(i=e.user.userInfo)||void 0===i?void 0:i.companyId})),[i,t]=(0,n.useState)(!1),[s,l]=(0,n.useState)(null),[o,c]=(0,n.useState)("add"),[u,h]=(0,n.useState)("active"),{data:x={},isLoading:v,error:g,refetch:y}=(0,a.CI)(e,{skip:!e}),f=x.trips||[],{activeTrips:b,completedTrips:N}=(0,n.useMemo)((()=>{const e=[],i=[];return f.forEach((t=>{"Completed"===t.status?i.push(t):e.push(t)})),{activeTrips:e,completedTrips:i}}),[f]),[k,{isLoading:C}]=(0,a.D1)(),w=(0,n.useCallback)(((e,i,t)=>{S.Ay[e]({message:i,description:t})}),[]),P=(0,n.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;l(e?e._id:null),c(e?"edit":"add"),t(!0)}),[]),A=(0,n.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1?arguments[1]:void 0;t(!1),l(null),c("add"),e&&w("success","Th\xe0nh c\xf4ng",i),y()}),[w,y]);return(0,j.jsxs)("div",{className:"container mx-auto p-8 bg-white shadow-md rounded-md",children:[(0,j.jsxs)("div",{className:"header flex justify-between items-center mb-6",children:[(0,j.jsx)(F,{level:3,className:"text-gray-800",children:"Qu\u1ea3n L\xfd Chuy\u1ebfn \u0110i"}),(0,j.jsxs)(_.A,{size:"large",children:["active"===u&&(0,j.jsx)(m.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a t\u1ea5t c\u1ea3 c\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n?",onConfirm:async()=>{try{const e=await k().unwrap();w("success","Th\xe0nh c\xf4ng",e.message||"C\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n \u0111\xe3 \u0111\u01b0\u1ee3c x\xf3a th\xe0nh c\xf4ng."),y()}catch(g){var e;const t=(null===g||void 0===g||null===(e=g.data)||void 0===e?void 0:e.message)||"C\xf3 l\u1ed7i x\u1ea3y ra khi x\xf3a c\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n.";w("error","L\u1ed7i",t)}},okText:"X\xf3a",cancelText:"H\u1ee7y",children:(0,j.jsx)(d.Ay,{type:"primary",danger:!0,loading:C,style:{backgroundColor:"#ff4d4f",borderColor:"#ff4d4f"},children:"X\xf3a Chuy\u1ebfn \u0110i Qu\xe1 H\u1ea1n"})}),"active"===u&&(0,j.jsx)(d.Ay,{type:"primary",onClick:()=>P(),children:"T\u1ea1o Chuy\u1ebfn \u0110i"})]})]}),(0,j.jsx)("div",{className:"content",children:(0,j.jsxs)(D.A,{activeKey:u,onChange:e=>{h(e)},type:"card",children:[(0,j.jsx)(q,{tab:"Chuy\u1ebfn \u0111i \u0111ang ho\u1ea1t \u0111\u1ed9ng",children:v?(0,j.jsx)("div",{className:"loading-spinner flex justify-center py-10",children:(0,j.jsx)(p.A,{tip:"\u0110ang t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i...",size:"large"})}):g?(0,j.jsx)(O.A,{message:"C\xf3 l\u1ed7i x\u1ea3y ra khi t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i",description:g.message,type:"error",showIcon:!0,className:"error-alert"}):(0,j.jsx)(T,{trips:b,openDrawer:P,hideAddButton:i,showNotification:w,refetch:y})},"active"),(0,j.jsx)(q,{tab:"Chuy\u1ebfn \u0111i \u0111\xe3 ho\xe0n th\xe0nh",children:v?(0,j.jsx)("div",{className:"loading-spinner flex justify-center py-10",children:(0,j.jsx)(p.A,{tip:"\u0110ang t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i...",size:"large"})}):g?(0,j.jsx)(O.A,{message:"C\xf3 l\u1ed7i x\u1ea3y ra khi t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i",description:g.message,type:"error",showIcon:!0,className:"error-alert"}):(0,j.jsx)(T,{trips:N,openDrawer:P,hideAddButton:i,showNotification:w,refetch:y,isCompleted:!0})},"completed")]})}),(0,j.jsx)(H.A,{title:s?"Ch\u1ec9nh S\u1eeda Chuy\u1ebfn \u0110i":"Th\xeam Chuy\u1ebfn \u0110i M\u1edbi",width:500,onClose:()=>A(!1),open:i,destroyOnClose:!0,children:(0,j.jsx)(I,{tripId:s,closeDrawer:e=>A(!0,e),trips:f,formMode:o,showNotification:w})})]})}},10254:(e,i,t)=>{t.d(i,{D:()=>a,v:()=>s});var n=t(34348),r=t.n(n);const a={parseUTCTimeForForm:e=>e?new Date(e):new Date,formatTimeForServer:e=>e?r()(e).utc().format():null,formatDisplayTime:e=>e?r()(e).tz("Asia/Ho_Chi_Minh").format("DD/MM/YYYY HH:mm"):""},s=e=>e?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e):"0 VND"}}]);
//# sourceMappingURL=48.5940677c.chunk.js.map