"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[326],{89326:(e,i,t)=>{t.r(i),t.d(i,{default:()=>E});var n=t(65043),r=t(83003),a=t(65868),s=t(62764),l=t(67290),o=t(96651),d=t(3188),c=t(40322),u=t(90696),h=t(91995),m=t(91686),p=t(94434),x=t(75995),v=t(60184),g=t(10254),y=t(34348),f=t.n(y),j=t(23927),b=t(15444),N=t(16569),T=t(42261),k=t(8354),C=t(70579);const{Title:w,Text:A}=j.A,{Search:P}=b.A,I=e=>{var i,t,r,a;let{tripId:l,onClose:o}=e;const{data:h,isLoading:p,error:x,refetch:v}=(0,s.iv)(l),[y,{isLoading:f}]=(0,s.HO)(),[j,b]=(0,n.useState)(null),[I,D]=(0,n.useState)(""),L=null===h||void 0===h||null===(i=h.data)||void 0===i?void 0:i.passengers.filter((e=>{var i,t,n;const r=(null===e||void 0===e||null===(i=e.userDetails)||void 0===i||null===(t=i.fullName)||void 0===t?void 0:t.toLowerCase())||"",a=(null===e||void 0===e||null===(n=e.userDetails)||void 0===n?void 0:n.phoneNumber)||"";return r.includes(I)||a.includes(I)})),S=[{title:"H\u1ecd t\xean",dataIndex:["userDetails","fullName"],key:"fullName",sorter:(e,i)=>e.userDetails.fullName.localeCompare(i.userDetails.fullName),render:e=>e||"Kh\xf4ng x\xe1c \u0111\u1ecbnh"},{title:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i",dataIndex:["userDetails","phoneNumber"],key:"phoneNumber",sorter:(e,i)=>e.userDetails.phoneNumber(i.userDetails.phoneNumber)},{title:"Gh\u1ebf \u0111\xe3 \u0111\u1eb7t",dataIndex:"seatNumbers",key:"seatNumbers",render:e=>(null===e||void 0===e?void 0:e.join(", "))||"Ch\u01b0a ch\u1ecdn gh\u1ebf"},{title:"T\u1ed5ng ti\u1ec1n",dataIndex:"totalPrice",key:"totalPrice",sorter:(e,i)=>e.totalPrice-i.totalPrice,render:e=>(0,g.v)(e)},{title:"Tr\u1ea1ng th\xe1i thanh to\xe1n",dataIndex:"paymentStatus",key:"paymentStatus",render:e=>(0,C.jsx)("span",{className:"font-medium "+("Paid"===e?"text-green-600":"text-red-600"),children:"Paid"===e?"\u0110\xe3 thanh to\xe1n":"Ch\u01b0a thanh to\xe1n"})},{title:"Thao t\xe1c",key:"action",render:(e,i)=>"Unpaid"===i.paymentStatus&&(0,C.jsx)(c.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n thu ti\u1ec1n v\xe9 n\xe0y kh\xf4ng?",onConfirm:()=>(async e=>{try{await y(e).unwrap(),N.Ay.success("Thanh to\xe1n th\xe0nh c\xf4ng."),v()}catch(t){var i;N.Ay.error((null===(i=t.data)||void 0===i?void 0:i.message)||"L\u1ed7i khi thu ti\u1ec1n.")}})(i._id),okText:"C\xf3",cancelText:"Kh\xf4ng",children:(0,C.jsx)(d.Ay,{type:"primary",loading:f&&j===i._id,onClick:()=>b(i._id),children:"Thu ti\u1ec1n"})})}];if(p)return(0,C.jsx)(m.A,{size:"large",className:"flex justify-center items-center mt-10"});if(x)return(0,C.jsx)(T.A,{type:"error",message:"L\u1ed7i khi t\u1ea3i d\u1eef li\u1ec7u h\xe0nh kh\xe1ch",showIcon:!0,className:"mt-4"});const _=(null===h||void 0===h||null===(t=h.data)||void 0===t?void 0:t.totalDue)||0,H=(null===h||void 0===h||null===(r=h.data)||void 0===r?void 0:r.totalPaid)||0,O=(null===h||void 0===h||null===(a=h.data)||void 0===a?void 0:a.totalUnpaid)||0;return(0,C.jsxs)("div",{className:"p-4",children:[(0,C.jsx)(w,{level:4,className:"mb-4",children:"Danh s\xe1ch \u0111\u1eb7t v\xe9"}),(0,C.jsx)("div",{className:"mb-4",children:(0,C.jsx)(P,{placeholder:"T\xecm ki\u1ebfm theo t\xean ho\u1eb7c s\u1ed1 \u0111i\u1ec7n tho\u1ea1i",enterButton:"T\xecm ki\u1ebfm",onSearch:e=>{D(e.toLowerCase())},allowClear:!0})}),(0,C.jsx)(u.A,{columns:S,dataSource:L,rowKey:e=>e._id,pagination:{pageSize:5},bordered:!0,locale:{emptyText:"Kh\xf4ng c\xf3 h\xe0nh kh\xe1ch n\xe0o"}}),(0,C.jsx)(k.A,{}),(0,C.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[(0,C.jsxs)("div",{children:[(0,C.jsx)(A,{strong:!0,children:"T\u1ed5ng s\u1ed1 ph\u1ea3i thu:"}),(0,C.jsx)(A,{className:"block",children:(0,g.v)(_)})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)(A,{strong:!0,children:"\u0110\xe3 thu:"}),(0,C.jsx)(A,{className:"block text-green-600",children:(0,g.v)(H)})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)(A,{strong:!0,children:"C\xf2n l\u1ea1i:"}),(0,C.jsx)(A,{className:"block text-red-600",children:(0,g.v)(O)})]})]}),(0,C.jsx)("div",{className:"flex justify-end mt-8",children:(0,C.jsx)(d.Ay,{type:"primary",onClick:o,size:"large",children:"\u0110\xf3ng"})})]})},D=e=>{let{trips:i,openDrawer:t,hideAddButton:y,refetch:j}=e;const b=(0,r.wA)(),[N]=(0,a.tJ)(),[T]=(0,a.E8)(),[k,w]=(0,n.useState)({open:!1,severity:"",message:""}),[A,P]=(0,n.useState)(null),[D,L]=(0,n.useState)(!1),[S,_]=(0,n.useState)([]),[H,O]=(0,n.useState)(null),{data:q,isLoading:F}=(0,s.BI)(),K=(e,i)=>{w({open:!0,severity:e,message:i})},z=()=>{O(null)},B=[{title:"\u0110i\u1ec3m kh\u1edfi h\xe0nh",dataIndex:["departureLocation","name"],key:"departureLocation"},{title:"\u0110i\u1ec3m \u0111\u1ebfn",dataIndex:["arrivalLocation","name"],key:"arrivalLocation"},{title:"Lo\u1ea1i xe",dataIndex:["busType","name"],key:"busType",render:e=>(0,C.jsx)("span",{className:"bg-green-200 text-green-800 px-2 py-1 rounded-full",children:e})},{title:"Th\u1eddi gian kh\u1edfi h\xe0nh",dataIndex:"departureTime",key:"departureTime",render:e=>g.D.formatDisplayTime(e)},{title:"Th\u1eddi gian \u0111\u1ebfn",dataIndex:"arrivalTime",key:"arrivalTime",render:e=>g.D.formatDisplayTime(e)},{title:"Gi\xe1 v\xe9",dataIndex:"basePrice",key:"basePrice",render:e=>(0,g.v)(e)},{title:"T\xe0i x\u1ebf",dataIndex:"drivers",key:"drivers",render:e=>e&&e.length>0?e.map((e=>(0,C.jsx)("span",{className:"block",children:e.fullName?`${e.fullName} (Driver)`:"Th\xf4ng tin kh\xf4ng x\xe1c \u0111\u1ecbnh"},e._id))):(0,C.jsx)("span",{className:"text-rose-400",children:"Ch\u01b0a c\xf3 t\xe0i x\u1ebf"})},{title:"Thao t\xe1c",key:"action",render:(e,n)=>{const r=n.drivers&&n.drivers.length>0;return(0,C.jsxs)("div",{className:"flex space-x-2",children:[(0,C.jsx)(o.A,{title:"Xem \u0111\u1eb7t v\xe9",children:(0,C.jsx)(d.Ay,{type:"link",className:"text-blue-500 hover:text-blue-700",onClick:()=>{return e=n._id,void O(e);var e},children:(0,C.jsx)(v.Ny1,{className:"inline mr-1 text-lg align-middle"})})}),(0,C.jsx)(o.A,{title:"S\u1eeda",children:(0,C.jsx)(d.Ay,{type:"link",className:"text-yellow-500 hover:text-yellow-700",onClick:()=>(e=>{const i={...e,departureTime:f().utc(e.departureTime).toISOString(),arrivalTime:f().utc(e.arrivalTime).toISOString()};t(i)})(n),children:(0,C.jsx)(v.uO9,{className:"inline mr-1 text-lg align-middle"})})}),!r&&(0,C.jsx)(o.A,{title:"Th\xeam t\xe0i x\u1ebf",children:(0,C.jsx)(d.Ay,{type:"link",className:"text-green-500 hover:text-green-700",onClick:()=>(P(n),void L(!0)),children:(0,C.jsx)(v.NPy,{className:"inline mr-1 text-lg align-middle"})})}),(0,C.jsx)(o.A,{title:"X\xf3a",children:(0,C.jsx)(c.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a chuy\u1ebfn \u0111i n\xe0y kh\xf4ng?",onConfirm:()=>(async e=>{try{await N(e).unwrap(),b((0,l.gg)("X\xf3a chuy\u1ebfn \u0111i th\xe0nh c\xf4ng."));const t=i.filter((i=>i._id!==e));b((0,l.hO)(t)),K("success","X\xf3a chuy\u1ebfn \u0111i th\xe0nh c\xf4ng."),j()}catch(t){b((0,l.Nh)("L\u1ed7i khi x\xf3a chuy\u1ebfn \u0111i: "+t.message)),K("error",`L\u1ed7i khi x\xf3a chuy\u1ebfn \u0111i: ${t.message}`)}})(n._id),okText:"C\xf3",cancelText:"Kh\xf4ng",children:(0,C.jsx)(d.Ay,{type:"link",className:"text-red-500 hover:text-red-700",children:(0,C.jsx)(v.qbC,{className:"inline mr-1 text-lg align-middle"})})})})]})}}];return(0,C.jsxs)("div",{className:"p-4",children:[(0,C.jsx)(u.A,{columns:B,dataSource:i,rowKey:e=>e._id,pagination:!1,bordered:!0,className:"bg-white shadow-md rounded-lg overflow-hidden"}),(0,C.jsx)(x.A,{open:k.open,severity:k.severity,message:k.message,onClose:()=>w({...k,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"}}),H&&(0,C.jsx)(h.A,{title:"Danh s\xe1ch \u0111\u1eb7t v\xe9",visible:!!H,onCancel:z,footer:null,width:800,children:(0,C.jsx)(I,{tripId:H,onClose:z})}),(0,C.jsx)(h.A,{title:"Th\xeam t\xe0i x\u1ebf",visible:D,onOk:async()=>{if(S.length)try{await T({tripId:A._id,driverIds:S}).unwrap(),K("success","Th\xeam t\xe0i x\u1ebf th\xe0nh c\xf4ng."),L(!1),j()}catch(t){var e,i;const n=(null===(e=t.data)||void 0===e?void 0:e.message)||"L\u1ed7i khi th\xeam t\xe0i x\u1ebf.",r=(null===(i=t.data)||void 0===i?void 0:i.conflictingDrivers)||[],a=r.length?`C\xe1c t\xe0i x\u1ebf g\xe2y xung \u0111\u1ed9t: ${r.join(", ")}`:"";K("error",`${n} ${a}`)}else K("error","B\u1ea1n ph\u1ea3i ch\u1ecdn \xedt nh\u1ea5t m\u1ed9t t\xe0i x\u1ebf")},onCancel:()=>L(!1),children:F?(0,C.jsx)(m.A,{}):q&&Array.isArray(q.drivers)&&q.drivers.length>0?(0,C.jsx)(p.A,{mode:"multiple",style:{width:"100%"},placeholder:"Ch\u1ecdn t\xe0i x\u1ebf",onChange:e=>_(e),children:q.drivers.map((e=>{var i;return(0,C.jsx)(p.A.Option,{value:e._id,children:null!==(i=e.userId)&&void 0!==i&&i.fullName?e.userId.fullName:"T\xean kh\xf4ng x\xe1c \u0111\u1ecbnh"},e._id)}))}):(0,C.jsx)("p",{children:"Kh\xf4ng c\xf3 t\xe0i x\u1ebf n\xe0o"})})]})};var L=t(31899),S=t.n(L),_=(t(25015),t(39052)),H=t(90480),O=t(86178),q=t.n(O);const F=e=>{var i,t;let{tripId:s,closeDrawer:l}=e;const{companyId:o}=(0,r.d4)((e=>e.user.userInfo)),[d]=(0,a._w)(),[c]=(0,a.Lr)(),{data:u}=(0,a.pY)(s,{skip:!s}),{data:h,isLoading:m}=(0,_.eg)(),{data:p,isLoading:x,error:v}=(0,H.rz)({companyId:o},{skip:!o}),[y,f]=(0,n.useState)({departureLocation:"",arrivalLocation:"",busType:"",departureTime:new Date,arrivalTime:new Date,basePrice:"",isRoundTrip:!1,pickupPoints:[],dropOffPoints:[]});(0,n.useEffect)((()=>{if(u&&u.data){var e,i,t;const n=u.data.trip;f({departureLocation:(null===n||void 0===n||null===(e=n.departureLocation)||void 0===e?void 0:e._id)||"",arrivalLocation:(null===n||void 0===n||null===(i=n.arrivalLocation)||void 0===i?void 0:i._id)||"",busType:(null===n||void 0===n||null===(t=n.busType)||void 0===t?void 0:t._id)||"",departureTime:g.D.parseUTCTimeForForm(n.departureTime),arrivalTime:g.D.parseUTCTimeForForm(n.arrivalTime),basePrice:null===n||void 0===n?void 0:n.basePrice,isRoundTrip:(null===n||void 0===n?void 0:n.isRoundTrip)||!1,pickupPoints:(null===n||void 0===n?void 0:n.pickupPoints)||[],dropOffPoints:(null===n||void 0===n?void 0:n.dropOffPoints)||[]})}}),[u]);const j=e=>{const{name:i,value:t,type:n,checked:r}=e.target;f({...y,[i]:"checkbox"===n?r:t})},b=(e,i)=>{f({...y,[e]:i})},N=(e,i,t)=>{const n=[...y.pickupPoints];n[e][i]=t,f({...y,pickupPoints:n})},T=(e,i,t)=>{const n=[...y.dropOffPoints];n[e][i]=t,f({...y,dropOffPoints:n})};return(0,C.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=((e,i)=>{const t=q()(e);return i.map(((e,i)=>{const n=15*i;return{...e,time:t.clone().add(n,"minutes").format("HH:mm")}}))})(y.departureTime,y.pickupPoints),i=((e,i)=>{const t=q()(e);return i.map(((e,n)=>{const r=15*(i.length-1-n);return{...e,time:t.clone().subtract(r,"minutes").format("HH:mm")}}))})(y.arrivalTime,y.dropOffPoints),t={...y,pickupPoints:e,dropOffPoints:i,departureTime:g.D.formatTimeForServer(y.departureTime),arrivalTime:g.D.formatTimeForServer(y.arrivalTime),basePrice:parseInt(y.basePrice,10)};s?await c({tripId:s,updatedTrip:t}).unwrap():await d(t).unwrap(),l()}catch(i){console.error("L\u1ed7i khi l\u01b0u chuy\u1ebfn \u0111i:",i)}},className:"p-4 bg-white rounded-lg shadow-lg",children:[(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m Kh\u1edfi H\xe0nh:"}),(0,C.jsxs)("select",{name:"departureLocation",value:y.departureLocation,onChange:j,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,C.jsx)("option",{value:"",children:"Ch\u1ecdn \u0111i\u1ec3m kh\u1edfi h\xe0nh"}),!m&&(null===h||void 0===h||null===(i=h.data)||void 0===i?void 0:i.map((e=>(0,C.jsxs)("option",{value:e._id,children:[e.name," - ",e.city]},e._id))))]})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m \u0110\u1ebfn:"}),(0,C.jsxs)("select",{name:"arrivalLocation",value:y.arrivalLocation,onChange:j,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,C.jsx)("option",{value:"",children:"Ch\u1ecdn \u0111i\u1ec3m \u0111\u1ebfn"}),!m&&(null===h||void 0===h||null===(t=h.data)||void 0===t?void 0:t.map((e=>(0,C.jsxs)("option",{value:e._id,children:[e.name," - ",e.city]},e._id))))]})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Th\u1eddi Gian Kh\u1edfi H\xe0nh:"}),(0,C.jsx)(S(),{selected:y.departureTime,onChange:e=>b("departureTime",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"dd/MM/yyyy HH:mm",className:"mt-2 p-3 border rounded w-full focus:ring focus:ring-blue-500",required:!0})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Th\u1eddi Gian \u0110\u1ebfn:"}),(0,C.jsx)(S(),{selected:y.arrivalTime,onChange:e=>b("arrivalTime",e),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"dd/MM/yyyy HH:mm",className:"mt-2 p-3 border rounded w-full focus:ring focus:ring-blue-500",required:!0})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m \u0110\xf3n:"}),y.pickupPoints.map(((e,i)=>(0,C.jsxs)("div",{className:"flex items-center mb-2",children:[(0,C.jsx)("input",{type:"text",placeholder:"\u0110\u1ecba \u0111i\u1ec3m",value:e.location,onChange:e=>N(i,"location",e.target.value),className:"mr-2 p-2 border rounded w-2/3 focus:ring focus:ring-green-500",required:!0}),(0,C.jsx)("input",{type:"text",placeholder:"Ghi ch\xfa",value:e.note,onChange:e=>N(i,"note",e.target.value),className:"mr-2 p-2 border rounded w-1/3 focus:ring focus:ring-green-500"}),(0,C.jsx)("button",{type:"button",onClick:()=>(e=>{const i=[...y.pickupPoints];i.splice(e,1),f({...y,pickupPoints:i})})(i),className:"text-red-500 hover:text-red-700",children:"X\xf3a"})]},i))),(0,C.jsx)("button",{type:"button",onClick:()=>{f({...y,pickupPoints:[...y.pickupPoints,{location:"",note:""}]})},className:"mt-2 text-blue-500 hover:text-blue-700",children:"+ Th\xeam \u0110i\u1ec3m \u0110\xf3n"})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u0110i\u1ec3m Tr\u1ea3:"}),y.dropOffPoints.map(((e,i)=>(0,C.jsxs)("div",{className:"flex items-center mb-2",children:[(0,C.jsx)("input",{type:"text",placeholder:"\u0110\u1ecba \u0111i\u1ec3m",value:e.location,onChange:e=>T(i,"location",e.target.value),className:"mr-2 p-2 border rounded w-2/3 focus:ring focus:ring-green-500",required:!0}),(0,C.jsx)("input",{type:"text",placeholder:"Ghi ch\xfa",value:e.note,onChange:e=>T(i,"note",e.target.value),className:"mr-2 p-2 border rounded w-1/3 focus:ring focus:ring-green-500"}),(0,C.jsx)("button",{type:"button",onClick:()=>(e=>{const i=[...y.dropOffPoints];i.splice(e,1),f({...y,dropOffPoints:i})})(i),className:"text-red-500 hover:text-red-700",children:"X\xf3a"})]},i))),(0,C.jsx)("button",{type:"button",onClick:()=>{f({...y,dropOffPoints:[...y.dropOffPoints,{location:"",note:""}]})},className:"mt-2 text-blue-500 hover:text-blue-700",children:"+ Th\xeam \u0110i\u1ec3m Tr\u1ea3"})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Lo\u1ea1i Xe:"}),x?(0,C.jsx)("p",{children:"\u0110ang t\u1ea3i danh s\xe1ch lo\u1ea1i xe..."}):v?(0,C.jsxs)("p",{className:"text-red-500",children:["L\u1ed7i khi t\u1ea3i danh s\xe1ch lo\u1ea1i xe: ",v.message]}):(0,C.jsxs)("select",{name:"busType",value:y.busType,onChange:j,className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0,children:[(0,C.jsx)("option",{value:"",children:"Ch\u1ecdn lo\u1ea1i xe"}),null===p||void 0===p?void 0:p.data.map((e=>(0,C.jsx)("option",{value:e._id,children:e.name},e._id)))]})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Gi\xe1 V\xe9 C\u01a1 B\u1ea3n:"}),(0,C.jsx)("input",{type:"number",name:"basePrice",value:y.basePrice,onChange:j,placeholder:"Nh\u1eadp gi\xe1 v\xe9 c\u01a1 b\u1ea3n",className:"mt-2 p-2 border rounded w-full focus:ring focus:ring-green-500",required:!0}),(0,C.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["Gi\xe1 v\xe9: ",(0,g.v)(y.basePrice)]})]}),(0,C.jsx)("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded w-full",children:s?"C\u1eadp Nh\u1eadt Chuy\u1ebfn \u0110i":"T\u1ea1o Chuy\u1ebfn \u0110i"})]})};var K=t(8918),z=t(80349),B=t(6051),G=t(48677),M=t(59748),X=t(37490),Y=t(1118);const V=()=>{const{data:e={},isLoading:i,error:t,refetch:r}=(0,s.HP)(),a=e.data||[],[l,{isLoading:o}]=(0,s.Ws)(),[p,{isLoading:x}]=(0,s.A)(),[v,g]=(0,n.useState)(!1),[y,f]=(0,n.useState)(null),[j]=M.A.useForm(),k=[{title:"Ng\u01b0\u1eddi Y\xeau C\u1ea7u",dataIndex:"userId",key:"userId",render:e=>(null===e||void 0===e?void 0:e.fullName)||"N/A"},{title:"Kh\u1edfi H\xe0nh",dataIndex:"departureLocation",key:"departureLocation",render:e=>(null===e||void 0===e?void 0:e.name)||"N/A"},{title:"\u0110i\u1ec3m \u0110\u1ebfn",dataIndex:"arrivalLocation",key:"arrivalLocation",render:e=>(null===e||void 0===e?void 0:e.name)||"N/A"},{title:"Th\u1eddi Gian",dataIndex:"preferredDepartureTime",key:"preferredDepartureTime",render:e=>e?new Date(e).toLocaleString():"N/A"},{title:"S\u1ed1 Gh\u1ebf",dataIndex:"seatNumbers",key:"seatNumbers",render:e=>(null===e||void 0===e?void 0:e.join(", "))||"N/A"},{title:"Tr\u1ea1ng Th\xe1i",dataIndex:"status",key:"status",render:e=>(0,C.jsx)(X.A,{status:"Pending"===e?"processing":"Approved"===e?"success":"error",text:"Pending"===e?"\u0110ang Ch\u1edd":"Approved"===e?"\u0110\xe3 Duy\u1ec7t":"\u0110\xe3 T\u1eeb Ch\u1ed1i"})},{title:"H\xe0nh \u0110\u1ed9ng",key:"actions",render:e=>(0,C.jsx)("div",{className:"flex gap-2",children:"Pending"===e.status&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(d.Ay,{type:"primary",onClick:()=>{return i=e._id,f(i),void g(!0);var i},loading:o,disabled:o||x,children:"Duy\u1ec7t"}),(0,C.jsx)(c.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n t\u1eeb ch\u1ed1i y\xeau c\u1ea7u n\xe0y?",onConfirm:()=>(async e=>{try{await p({requestId:e,reason:"Kh\xf4ng ph\xf9 h\u1ee3p v\u1edbi l\u1ecbch tr\xecnh"}).unwrap(),N.Ay.success("Y\xeau c\u1ea7u \u0111\xe3 b\u1ecb t\u1eeb ch\u1ed1i!"),r()}catch(t){var i;N.Ay.error((null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message)||"T\u1eeb ch\u1ed1i y\xeau c\u1ea7u th\u1ea5t b\u1ea1i.")}})(e._id),okText:"T\u1eeb Ch\u1ed1i",cancelText:"H\u1ee7y",children:(0,C.jsx)(d.Ay,{type:"danger",loading:x,disabled:o||x,children:"T\u1eeb Ch\u1ed1i"})})]})})}];return(0,C.jsxs)("div",{className:"container mx-auto p-6 bg-white rounded-md shadow-md",children:[i?(0,C.jsx)("div",{className:"flex justify-center py-2",children:(0,C.jsx)(m.A,{tip:"\u0110ang t\u1ea3i danh s\xe1ch y\xeau c\u1ea7u...",size:"large"})}):t?(0,C.jsx)(T.A,{message:"C\xf3 l\u1ed7i x\u1ea3y ra khi t\u1ea3i danh s\xe1ch y\xeau c\u1ea7u",description:t.message,type:"error",showIcon:!0}):0===a.length?(0,C.jsx)("p",{className:"text-center text-gray-500",children:"Kh\xf4ng c\xf3 y\xeau c\u1ea7u n\xe0o."}):(0,C.jsx)(u.A,{columns:k,dataSource:a,rowKey:e=>e._id,pagination:{pageSize:5,showSizeChanger:!0,pageSizeOptions:["5","10","20"]}}),(0,C.jsx)(h.A,{title:"Nh\u1eadp th\xf4ng tin chuy\u1ebfn \u0111i",visible:v,onCancel:()=>g(!1),onOk:()=>j.submit(),okText:"X\xe1c Nh\u1eadn",cancelText:"H\u1ee7y",children:(0,C.jsxs)(M.A,{form:j,layout:"vertical",onFinish:async e=>{try{const i={basePrice:e.basePrice,pickupPoints:e.pickupPoints.split(",").map((e=>({time:"",location:e.trim(),note:""}))),dropOffPoints:e.dropOffPoints.split(",").map((e=>({time:"",location:e.trim(),note:""})))};console.log("Sending approve request with ID:",y),console.log("Sending approve request with values:",i);const t=await l({requestId:y,...i}).unwrap();console.log("Approve response:",t),N.Ay.success("Y\xeau c\u1ea7u \u0111\xe3 \u0111\u01b0\u1ee3c duy\u1ec7t th\xe0nh c\xf4ng!"),g(!1),j.resetFields(),r()}catch(t){var i;console.error("Approve error:",t),N.Ay.error((null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message)||"Duy\u1ec7t y\xeau c\u1ea7u th\u1ea5t b\u1ea1i.")}},children:[(0,C.jsx)(M.A.Item,{label:"Gi\xe1 V\xe9 C\u01a1 B\u1ea3n",name:"basePrice",rules:[{required:!0,message:"Vui l\xf2ng nh\u1eadp gi\xe1 v\xe9 c\u01a1 b\u1ea3n!"}],children:(0,C.jsx)(Y.A,{min:0,style:{width:"100%"},placeholder:"Nh\u1eadp gi\xe1 v\xe9"})}),(0,C.jsx)(M.A.Item,{label:"\u0110i\u1ec3m \u0110\xf3n",name:"pickupPoints",rules:[{required:!0,message:"Vui l\xf2ng nh\u1eadp \u0111i\u1ec3m \u0111\xf3n!"}],children:(0,C.jsx)(b.A.TextArea,{rows:2,placeholder:"Nh\u1eadp danh s\xe1ch \u0111i\u1ec3m \u0111\xf3n (ng\u0103n c\xe1ch b\u1edfi d\u1ea5u ph\u1ea9y)"})}),(0,C.jsx)(M.A.Item,{label:"\u0110i\u1ec3m Tr\u1ea3",name:"dropOffPoints",rules:[{required:!0,message:"Vui l\xf2ng nh\u1eadp \u0111i\u1ec3m tr\u1ea3!"}],children:(0,C.jsx)(b.A.TextArea,{rows:2,placeholder:"Nh\u1eadp danh s\xe1ch \u0111i\u1ec3m tr\u1ea3 (ng\u0103n c\xe1ch b\u1edfi d\u1ea5u ph\u1ea9y)"})})]})})]})},{Title:$}=j.A,{TabPane:U}=K.A,E=()=>{const e=(0,r.d4)((e=>{var i;return null===(i=e.user.userInfo)||void 0===i?void 0:i.companyId})),[i,t]=(0,n.useState)(!1),[l,o]=(0,n.useState)(null),[u,h]=(0,n.useState)("add"),[p,x]=(0,n.useState)("active"),{data:v={},isLoading:g,error:y,refetch:f}=(0,a.CI)(e,{skip:!e}),j=v.trips||[],{activeTrips:b,completedTrips:N}=(0,n.useMemo)((()=>{const e=[],i=[];return j.forEach((t=>{"Completed"===t.status?i.push(t):e.push(t)})),{activeTrips:e,completedTrips:i}}),[j]),{data:k={},isLoading:w}=(0,s.HP)(),A=k.data||[],[P,{isLoading:I}]=(0,a.D1)(),L=(0,n.useCallback)(((e,i,t)=>{z.Ay[e]({message:i,description:t})}),[]),S=(0,n.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;o(e?e._id:null),h(e?"edit":"add"),t(!0)}),[]),_=(0,n.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1?arguments[1]:void 0;t(!1),o(null),h("add"),e&&L("success","Th\xe0nh c\xf4ng",i),f()}),[L,f]);return(0,C.jsxs)("div",{className:"container mx-auto p-8 bg-white shadow-md rounded-md",children:[(0,C.jsxs)("div",{className:"header flex justify-between items-center mb-6",children:[(0,C.jsx)($,{level:3,className:"text-gray-800",children:"Qu\u1ea3n L\xfd Chuy\u1ebfn \u0110i"}),(0,C.jsxs)(B.A,{size:"large",children:["active"===p&&(0,C.jsx)(c.A,{title:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a t\u1ea5t c\u1ea3 c\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n?",onConfirm:async()=>{try{const e=await P().unwrap();L("success","Th\xe0nh c\xf4ng",e.message||"C\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n \u0111\xe3 \u0111\u01b0\u1ee3c x\xf3a th\xe0nh c\xf4ng."),f()}catch(y){var e;const t=(null===y||void 0===y||null===(e=y.data)||void 0===e?void 0:e.message)||"C\xf3 l\u1ed7i x\u1ea3y ra khi x\xf3a c\xe1c chuy\u1ebfn \u0111i \u0111\xe3 qu\xe1 h\u1ea1n.";L("error","L\u1ed7i",t)}},okText:"X\xf3a",cancelText:"H\u1ee7y",children:(0,C.jsx)(d.Ay,{type:"primary",danger:!0,loading:I,style:{backgroundColor:"#ff4d4f",borderColor:"#ff4d4f"},children:"X\xf3a Chuy\u1ebfn \u0110i Qu\xe1 H\u1ea1n"})}),"active"===p&&(0,C.jsx)(d.Ay,{type:"primary",onClick:()=>S(),children:"T\u1ea1o Chuy\u1ebfn \u0110i"})]})]}),(0,C.jsx)("div",{className:"content",children:(0,C.jsxs)(K.A,{activeKey:p,onChange:e=>{x(e)},type:"card",children:[(0,C.jsx)(U,{tab:`Chuy\u1ebfn \u0111i \u0111ang ho\u1ea1t \u0111\u1ed9ng (${b.length})`,children:g?(0,C.jsx)("div",{className:"loading-spinner flex justify-center py-10",children:(0,C.jsx)(m.A,{tip:"\u0110ang t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i...",size:"large"})}):y?(0,C.jsx)(T.A,{message:"C\xf3 l\u1ed7i x\u1ea3y ra khi t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i",description:y.message,type:"error",showIcon:!0,className:"error-alert"}):(0,C.jsx)(D,{trips:b,openDrawer:S,hideAddButton:i,showNotification:L,refetch:f})},"active"),(0,C.jsx)(U,{tab:`Chuy\u1ebfn \u0111i \u0111\xe3 ho\xe0n th\xe0nh (${N.length})`,children:g?(0,C.jsx)("div",{className:"loading-spinner flex justify-center py-10",children:(0,C.jsx)(m.A,{tip:"\u0110ang t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i...",size:"large"})}):y?(0,C.jsx)(T.A,{message:"C\xf3 l\u1ed7i x\u1ea3y ra khi t\u1ea3i danh s\xe1ch chuy\u1ebfn \u0111i",description:y.message,type:"error",showIcon:!0,className:"error-alert"}):(0,C.jsx)(D,{trips:N,openDrawer:S,hideAddButton:i,showNotification:L,refetch:f,isCompleted:!0})},"completed"),(0,C.jsx)(U,{tab:`Y\xeau c\u1ea7u m\u1edf chuy\u1ebfn \u0111i (${w?"...":A.length})`,children:(0,C.jsx)(V,{companyId:e})},"requests")]})}),(0,C.jsx)(G.A,{title:l?"Ch\u1ec9nh S\u1eeda Chuy\u1ebfn \u0110i":"Th\xeam Chuy\u1ebfn \u0110i M\u1edbi",width:500,onClose:()=>_(!1),open:i,destroyOnClose:!0,children:(0,C.jsx)(F,{tripId:l,closeDrawer:e=>_(!0,e),trips:j,formMode:u,showNotification:L})})]})}},10254:(e,i,t)=>{t.d(i,{D:()=>a,v:()=>s});var n=t(34348),r=t.n(n);const a={parseUTCTimeForForm:e=>e?new Date(e):new Date,formatTimeForServer:e=>e?r()(e).utc().format():null,formatDisplayTime:e=>e?r()(e).tz("Asia/Ho_Chi_Minh").format("DD/MM/YYYY HH:mm"):""},s=e=>e?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e):"0 VND"}}]);
//# sourceMappingURL=326.b8abed8f.chunk.js.map