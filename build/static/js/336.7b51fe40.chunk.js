"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[336],{5740:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var a=s(65043),r=s(73216),l=s(65868),i=s(83003),n=s(42104),c=s(91995),o=s(10254),d=s(92382),m=(s(4430),s(69078),s(70579));const h=e=>{let{direction:t,onClick:s}=e;return(0,m.jsx)("button",{onClick:s,className:`absolute ${"next"===t?"right-4":"left-4"} top-1/2 transform -translate-y-1/2 bg-white text-gray-700 p-3 rounded-full shadow-md hover:bg-gray-100 focus:outline-none transition duration-300`,children:"next"===t?(0,m.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}):(0,m.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})},x=e=>{let{trip:t,activeTab:s,setActiveTab:r}=e;const l=(0,a.useRef)(null),i=(0,a.useRef)(null);return(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"flex flex-wrap justify-between md:justify-around border-b mb-6",children:["pickupDropOff","discounts","policy","images","feedbacks"].map(((e,t)=>(0,m.jsxs)("button",{className:"relative px-6 py-4 text-base font-semibold tracking-wide transition duration-300 "+(s===e?"text-blue-700":"text-gray-600 hover:text-blue-600"),onClick:()=>r(e),children:["pickupDropOff"===e?"\u0110i\u1ec3m \u0111\xf3n/tr\u1ea3":"discounts"===e?"\u01afu \u0111\xe3i":"policy"===e?"Ch\xednh s\xe1ch":"images"===e?"H\xecnh \u1ea3nh":"\u0110\xe1nh gi\xe1",s===e&&(0,m.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-1 bg-blue-700 rounded-t-md"})]},t)))}),(0,m.jsx)("div",{className:"bg-gray-50 shadow-lg rounded-lg overflow-hidden",children:(()=>{switch(s){case"pickupDropOff":return(0,m.jsxs)("div",{className:"p-6 animate-fadeIn",children:[(0,m.jsx)("h3",{className:"font-semibold text-2xl mb-6 text-blue-700",children:"\u0110i\u1ec3m \u0111\xf3n / \u0110i\u1ec3m tr\u1ea3"}),(0,m.jsx)("p",{className:"text-base text-gray-700 mb-6 italic",children:"C\xe1c m\u1ed1c th\u1eddi gian \u0111\xf3n, tr\u1ea3 b\xean d\u01b0\u1edbi l\xe0 th\u1eddi gian d\u1ef1 ki\u1ebfn. L\u1ecbch n\xe0y c\xf3 th\u1ec3 thay \u0111\u1ed5i t\xf9y t\xecnh h\xecnh th\u1ef1c t\u1ebf."}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,m.jsxs)("div",{className:"md:border-r md:pr-6",children:[(0,m.jsx)("h4",{className:"font-semibold text-xl text-gray-800 mb-4",children:"\u0110i\u1ec3m \u0111\xf3n"}),(0,m.jsx)("ul",{className:"space-y-4",children:t.pickupPoints&&t.pickupPoints.length>0?t.pickupPoints.map(((e,t)=>(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"text-blue-600 mt-1 mr-3",children:(0,m.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{d:"M10 2a6 6 0 016 6c0 5.25-6 10-6 10S4 13.25 4 8a6 6 0 016-6z"})})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-gray-800 font-medium",children:e.time}),(0,m.jsx)("p",{className:"text-gray-600",children:e.location})]})]},t))):(0,m.jsx)("p",{children:"Kh\xf4ng c\xf3 th\xf4ng tin \u0111i\u1ec3m \u0111\xf3n."})})]}),(0,m.jsxs)("div",{className:"mt-8 md:mt-0",children:[(0,m.jsx)("h4",{className:"font-semibold text-xl text-gray-800 mb-4",children:"\u0110i\u1ec3m tr\u1ea3"}),(0,m.jsx)("ul",{className:"space-y-4",children:t.dropOffPoints&&t.dropOffPoints.length>0?t.dropOffPoints.map(((e,t)=>(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"text-green-600 mt-1 mr-3",children:(0,m.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{d:"M10 2a6 6 0 016 6c0 5.25-6 10-6 10S4 13.25 4 8a6 6 0 016-6z"})})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-gray-800 font-medium",children:e.time}),(0,m.jsx)("p",{className:"text-gray-600",children:e.location})]})]},t))):(0,m.jsx)("p",{children:"Kh\xf4ng c\xf3 th\xf4ng tin \u0111i\u1ec3m tr\u1ea3."})})]})]})]});case"discounts":return(0,m.jsxs)("div",{className:"p-6 animate-fadeIn",children:[(0,m.jsx)("h3",{className:"font-semibold text-2xl mb-6 text-blue-700",children:"\u01afu \u0111\xe3i \u0111\u1eb7c bi\u1ec7t"}),(0,m.jsxs)("ul",{className:"space-y-4",children:[(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"text-yellow-500 mt-1 mr-3",children:(0,m.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{d:"M9.049 2.927C9.469 1.78 10.531 1.78 10.951 2.927l1.362 3.724a1 1 0 00.949.69h3.943c1.168 0 1.657 1.495.712 2.178l-3.098 2.251a1 1 0 00-.364 1.118l1.362 3.724c.42 1.147-.895 2.094-1.829 1.41l-3.098-2.25a1 1 0 00-1.176 0l-3.098 2.25c-.934.684-2.249-.263-1.829-1.41l1.362-3.724a1 1 0 00-.364-1.118L2.484 9.52c-.945-.683-.456-2.178.712-2.178h3.943a1 1 0 00.949-.69l1.362-3.724z"})})}),(0,m.jsx)("p",{className:"text-gray-700",children:"Gi\u1ea3m 50% t\u1ed1i \u0111a 250k cho v\xe9 \u0111\u1ea7u ti\xean"})]}),(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"text-yellow-500 mt-1 mr-3",children:(0,m.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{d:"M9.049 2.927C9.469 1.78 10.531 1.78 10.951 2.927l1.362 3.724a1 1 0 00.949.69h3.943c1.168 0 1.657 1.495.712 2.178l-3.098 2.251a1 1 0 00-.364 1.118l1.362 3.724c.42 1.147-.895 2.094-1.829 1.41l-3.098-2.25a1 1 0 00-1.176 0l-3.098 2.25c-.934.684-2.249-.263-1.829-1.41l1.362-3.724a1 1 0 00-.364-1.118L2.484 9.52c-.945-.683-.456-2.178.712-2.178h3.943a1 1 0 00.949-.69l1.362-3.724z"})})}),(0,m.jsx)("p",{className:"text-gray-700",children:"Gi\u1ea3m 20% cho m\u1ecdi v\xe9 ti\u1ebfp theo"})]})]})]});case"policy":return(0,m.jsxs)("div",{className:"p-6 animate-fadeIn",children:[(0,m.jsx)("h3",{className:"font-semibold text-2xl mb-6 text-blue-700",children:"Ch\xednh s\xe1ch"}),(0,m.jsxs)("ul",{className:"space-y-4",children:[(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"text-green-500 mt-1 mr-3",children:(0,m.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm-1-11V5h2v2h-2zm0 4v6h2v-6h-2z",clipRule:"evenodd"})})}),(0,m.jsx)("p",{className:"text-gray-700",children:"Ho\xe0n ti\u1ec1n 100% n\u1ebfu hu\u1ef7 tr\u01b0\u1edbc 24 gi\u1edd."})]}),(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"text-green-500 mt-1 mr-3",children:(0,m.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm-1-11V5h2v2h-2zm0 4v6h2v-6h-2z",clipRule:"evenodd"})})}),(0,m.jsx)("p",{className:"text-gray-700",children:"H\u1ed7 tr\u1ee3 \u0111\u1ed5i v\xe9 mi\u1ec5n ph\xed 1 l\u1ea7n."})]}),(0,m.jsxs)("li",{className:"flex items-start",children:[(0,m.jsx)("span",{className:"text-green-500 mt-1 mr-3",children:(0,m.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm-1-11V5h2v2h-2zm0 4v6h2v-6h-2z",clipRule:"evenodd"})})}),(0,m.jsx)("p",{className:"text-gray-700",children:"B\u1ea3o hi\u1ec3m chuy\u1ebfn \u0111i t\u1ed1i \u0111a 1 t\u1ef7 VN\u0110."})]})]})]});case"images":const e={dots:!1,arrows:!0,infinite:!0,speed:800,slidesToShow:1,slidesToScroll:1,asNavFor:i.current,fade:!0,nextArrow:(0,m.jsx)(h,{direction:"next"}),prevArrow:(0,m.jsx)(h,{direction:"prev"})},s={dots:!1,arrows:!1,infinite:!0,speed:800,slidesToShow:5,slidesToScroll:1,focusOnSelect:!0,asNavFor:l.current,centerMode:!0,centerPadding:"0px"};return(0,m.jsxs)("div",{className:"p-6 animate-fadeIn",children:[(0,m.jsx)("h3",{className:"font-semibold text-2xl mb-6 text-blue-700",children:"H\xecnh \u1ea3nh"}),(0,m.jsxs)("div",{className:"w-full",children:[(0,m.jsx)("div",{className:"relative",children:(0,m.jsx)(d.A,{...e,ref:l,children:t.busType.images&&t.busType.images.map(((e,t)=>(0,m.jsx)("div",{className:"flex justify-center",children:(0,m.jsx)("img",{src:e,alt:`Bus image ${t+1}`,className:"w-full max-h-96 object-cover rounded-lg shadow-lg"})},t)))})}),(0,m.jsx)(d.A,{...s,ref:i,className:"mt-6",children:t.busType.images&&t.busType.images.map(((e,t)=>(0,m.jsx)("div",{className:"px-1",children:(0,m.jsx)("img",{src:e,alt:`Thumbnail ${t+1}`,className:"w-full h-20 object-cover rounded-md shadow-md cursor-pointer hover:ring-2 hover:ring-blue-500 transition duration-300"})},t)))})]})]});case"feedbacks":return(0,m.jsxs)("div",{className:"p-6 animate-fadeIn",children:[(0,m.jsx)("h3",{className:"font-semibold text-2xl mb-6 text-blue-700",children:"\u0110\xe1nh gi\xe1 kh\xe1ch h\xe0ng"}),t.companyId.feedbacks&&t.companyId.feedbacks.length>0?(0,m.jsx)("div",{className:"space-y-8",children:t.companyId.feedbacks.map(((e,t)=>(0,m.jsxs)("div",{className:"p-6 border rounded-lg shadow-md bg-white hover:shadow-lg transition duration-300 flex items-start",children:[(0,m.jsx)("div",{className:"w-14 h-14 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-xl mr-6",children:e.fullName[0].toUpperCase()}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,m.jsx)("p",{className:"font-bold text-gray-800 text-lg",children:e.fullName}),(0,m.jsx)("div",{className:"flex items-center",children:[...Array(5)].map(((t,s)=>(0,m.jsx)("svg",{className:"w-5 h-5 "+(s<e.rating?"text-yellow-500":"text-gray-300"),fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{d:"M9.049 2.927C9.469 1.78 10.531 1.78 10.951 2.927l1.362 3.724a1 1 0 00.949.69h3.943c1.168 0 1.657 1.495.712 2.178l-3.098 2.251a1 1 0 00-.364 1.118l1.362 3.724c.42 1.147-.895 2.094-1.829 1.41l-3.098-2.25a1 1 0 00-1.176 0l-3.098 2.25c-.934.684-2.249-.263-1.829-1.41l1.362-3.724a1 1 0 00-.364-1.118L2.484 9.52c-.945-.683-.456-2.178.712-2.178h3.943a1 1 0 00.949-.69l1.362-3.724z"})},s)))})]}),(0,m.jsx)("p",{className:"text-gray-700 mb-4",children:e.comment}),(0,m.jsx)("p",{className:"text-gray-500 text-sm",children:new Date(e.createdAt).toLocaleDateString()})]})]},t)))}):(0,m.jsx)("p",{children:"Ch\u01b0a c\xf3 \u0111\xe1nh gi\xe1 n\xe0o."})]});default:return null}})()})]})};var u=s(31462);const p=e=>{let{trip:t,onToggle:s,loading:r}=e;const[l,i]=(0,a.useState)(!1),[n,d]=(0,a.useState)(!1),[h,p]=(0,a.useState)("discounts"),g=t.busType.images&&t.busType.images.length>0?t.busType.images[0]:"https://via.placeholder.com/150";return(0,m.jsxs)("div",{className:"border border-gray-200  rounded-lg shadow-md hover:shadow-lg p-4 mb-6 transition-shadow",children:[(0,m.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-4",children:[(0,m.jsxs)("div",{className:"relative w-full md:w-1/5 flex-shrink-0",children:[(0,m.jsx)("img",{src:g,alt:"Bus",className:"w-full h-28 object-cover rounded-lg",onClick:()=>{i(!0),p("images")}}),t.instantConfirmation&&(0,m.jsx)("div",{className:"absolute top-1 left-1 bg-green-600 text-white text-xs px-2 py-1 rounded",children:"X\xe1c nh\u1eadn t\u1ee9c th\xec"})]}),(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center",children:[(0,m.jsx)("h3",{className:"font-semibold text-lg text-gray-800",children:t.companyId.name}),(0,m.jsxs)("div",{className:"flex items-center",children:[(e=>{const t=Math.max(0,Math.min(5,Number(e)||0)),s=Math.floor(t),a=t%1>=.5?1:0,r=5-s-a;return(0,m.jsxs)("div",{className:"flex items-center",children:[Array(s).fill().map(((e,t)=>(0,m.jsx)(u.Lqq,{className:"text-yellow-500"},`full-${t}`))),1===a&&(0,m.jsx)(u.vOy,{className:"text-yellow-500"}),Array(r).fill().map(((e,t)=>(0,m.jsx)(u.oqo,{className:"text-gray-300"},`empty-${t}`)))]})})(t.companyId.averageRating||0),(0,m.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",t.companyId.totalReviews||0,")"]})]})]}),(0,m.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[t.busType.description," (",t.busType.seats," ch\u1ed7)"]}),(0,m.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("p",{className:"text-lg font-bold text-gray-800",children:new Date(t.departureTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,m.jsx)("p",{className:"text-sm text-gray-500",children:t.departureLocation.name})]}),(0,m.jsxs)("div",{className:"text-center text-gray-400 text-sm",children:[Math.round((new Date(t.arrivalTime)-new Date(t.departureTime))/36e5)||1," ","gi\u1edd"]}),(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("p",{className:"text-lg font-bold text-gray-800",children:new Date(t.arrivalTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,m.jsx)("p",{className:"text-sm text-gray-500",children:t.arrivalLocation.name})]})]})]}),(0,m.jsxs)("div",{className:"text-right w-full md:w-auto flex-shrink-0",children:[(0,m.jsxs)("p",{className:"text-xl font-bold text-red-600",children:[(0,o.v)(t.basePrice)," VND"]}),t.discount&&(0,m.jsxs)("p",{className:"text-sm text-gray-500 line-through",children:[(0,o.v)(t.originalPrice)," VND"]}),(0,m.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["C\xf2n ",t.availableSeats," ch\u1ed7 tr\u1ed1ng"]}),(0,m.jsx)("button",{onClick:()=>{l&&i(!1),s()},className:"bg-yellow-500 text-white px-5 py-2 mt-2 rounded-lg hover:bg-yellow-600 transition",disabled:r,children:"Ch\u1ecdn chuy\u1ebfn"})]})]}),(0,m.jsx)("div",{className:"mt-4",children:(0,m.jsx)("button",{onClick:()=>i(!l),className:"text-blue-600 text-sm",children:l?"\u1ea8n chi ti\u1ebft":"Th\xf4ng tin chi ti\u1ebft"})}),l&&(0,m.jsx)("div",{className:"mt-4 bg-gray-100 rounded-lg p-4",children:(0,m.jsx)(x,{trip:t,activeTab:h,setActiveTab:p})}),(0,m.jsx)(c.A,{visible:n,footer:null,onCancel:()=>{d(!1)},title:"H\xecnh \u1ea2nh Xe",children:(0,m.jsx)("div",{className:"grid grid-cols-3 gap-4",children:t.busType.images&&t.busType.images.map(((e,t)=>(0,m.jsx)("img",{src:e,alt:`Bus image ${t+1}`,className:"w-full h-32 object-cover rounded-lg"},t)))})})]})};var g=s(38179),f=s(75088),j=s(47196);const b=e=>{let{seatsData:t,isLoadingSeats:s,handleSeatSelect:a,selectedSeats:r,lockTimers:l,loading:i,totalPrice:n,handleContinue:c,error:d,userId:h}=e;const x=e=>1===e.seatNumber?"text-gray-500 cursor-not-allowed":r.includes(e.seatNumber)?"text-green-500":e.lockedBy&&e.lockedBy!==h?"text-orange-500":e.isAvailable?[2,3,4,5,6].includes(e.seatNumber)?"text-yellow-500":"text-green-300":"text-red-500",u=(e,t)=>{const s=(e=>{const t={Front:[],Middle:[],Back:[]};return e.forEach((e=>{t[e.seatRow]&&t[e.seatRow].push(e)})),t})(e);return(0,m.jsxs)("div",{className:"mb-6",children:[(0,m.jsx)("h4",{className:"text-lg font-semibold text-center text-gray-700 mb-4",children:t}),Object.entries(s).map((e=>{let[t,s]=e;return(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("h5",{className:"text-sm font-medium text-gray-600 mb-4",children:"H\xe0ng "+("Front"===t?"\u0111\u1ea7u":"Middle"===t?"gi\u1eefa":"cu\u1ed1i")}),(0,m.jsx)("div",{className:"grid gap-5 mx-auto",style:{gridTemplateColumns:`repeat(${Math.min(s.length,3)}, minmax(0, 1fr))`},children:s.map((e=>(0,m.jsxs)("button",{onClick:()=>a(e.seatNumber),disabled:i,className:`relative p-2 text-2xl cursor-pointer ${x(e)}`,children:[(0,m.jsx)(j.JgQ,{size:30}),(0,m.jsx)("span",{className:"absolute text-sm font-medium -bottom-2 left-1/2 transform -translate-x-1/2 text-red-700",children:e.seatNumber}),l[e.seatNumber]&&(0,m.jsx)(f.A,{className:"absolute -top-1 -right-1 h-4 w-4"})]},e._id)))})]},t)}))]})};return(0,m.jsx)(g.e,{show:!0,enter:"transition-opacity duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,m.jsxs)("div",{className:"border-t mt-4 pt-4 space-y-6",children:[(0,m.jsxs)("div",{className:"flex flex-row flex-wrap justify-around space-x-4 mb-4 text-sm text-gray-700",children:[(0,m.jsxs)("div",{className:"flex items-center mb-2",children:[(0,m.jsx)(j.JgQ,{className:"text-gray-500 mr-2"}),"Gh\u1ebf kh\xf4ng b\xe1n"]}),(0,m.jsxs)("div",{className:"flex items-center mb-2",children:[(0,m.jsx)(j.JgQ,{className:"text-yellow-500 mr-2"}),"Gh\u1ebf VIP"]}),(0,m.jsxs)("div",{className:"flex items-center mb-2",children:[(0,m.jsx)(j.JgQ,{className:"text-green-500 mr-2"}),"\u0110\xe3 ch\u1ecdn"]}),(0,m.jsxs)("div",{className:"flex items-center mb-2",children:[(0,m.jsx)(j.JgQ,{className:"text-orange-500 mr-2"}),"T\u1ea1m th\u1eddi gi\u1eef"]}),(0,m.jsxs)("div",{className:"flex items-center mb-2",children:[(0,m.jsx)(j.JgQ,{className:"text-green-300 mr-2"}),"C\xf3 s\u1eb5n"]}),(0,m.jsxs)("div",{className:"flex items-center mb-2",children:[(0,m.jsx)(j.JgQ,{className:"text-red-500 mr-2"}),"\u0110\xe3 \u0111\u1eb7t"]})]}),(0,m.jsxs)("div",{className:"flex justify-center w-full",children:[(0,m.jsx)("div",{className:`w-full ${t.upper?"md:w-1/2":"w-2/3"} flex justify-center`,children:u(t.lower,"T\u1ea7ng D\u01b0\u1edbi")}),t.upper&&t.upper.length>0&&(0,m.jsx)("div",{className:"md:w-z1/2 pl-4",children:u(t.upper,"T\u1ea7ng Tr\xean")})]}),(0,m.jsxs)("div",{className:"mt-6 flex justify-around h-[80px] items-center border-t pt-4",children:[(0,m.jsxs)("div",{className:"text-sm text-gray-700",children:["Gh\u1ebf \u0111\xe3 ch\u1ecdn:",(0,m.jsx)("span",{className:"font-medium",children:r.join(", ")})]}),(0,m.jsxs)("div",{className:"text-lg font-semibold text-gray-900",children:["T\u1ed5ng: ",(0,o.v)(n)," VND"]}),(0,m.jsx)("button",{onClick:c,disabled:0===r.length||i,className:"px-6 py-2 rounded-lg text-white transition duration-300\n              "+(0===r.length||i?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:"Ti\u1ebfp t\u1ee5c"})]}),d&&(0,m.jsx)("p",{className:"text-red-500 mt-2",children:d})]})})},v=e=>{let{trip:t,isOpen:s,onToggle:c,onReleaseSeats:o}=e;const d=(0,r.Zp)(),h=(0,a.useRef)(null),x=(0,i.d4)((e=>e.user.userInfo)),u=null===x||void 0===x?void 0:x.id,[g,f]=(0,a.useState)(null),[j,v]=(0,a.useState)([]),[N,y]=(0,a.useState)({lower:[],upper:[]}),[w,k]=(0,a.useState)({}),[T,S]=(0,a.useState)(null),[C,D]=(0,a.useState)(!1),[R,B]=(0,a.useState)(0),{data:P,isLoading:L}=(0,l.BX)(t._id,{skip:!s}),A=(0,a.useCallback)((()=>{try{return h.current=(0,n.Ay)("https://server-zeym.onrender.com",{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),h.current.on("connect",(()=>{console.log("Connected to socket server"),s&&t._id&&(h.current.emit("joinTrip",t._id),console.log(`Joining trip room: ${t._id}`))})),h.current.on("connect_error",(e=>{console.error("Socket connection error:",e),S("Unable to connect to booking service. Please try again later.")})),()=>{h.current&&h.current.disconnect()}}catch(T){console.error("Socket setup error:",T),S("Unable to initialize booking service. Please try again later.")}}),[t._id,s]);(0,a.useEffect)((()=>{P&&(y(P.data),S(null))}),[P]),(0,a.useEffect)((()=>{h.current||A();const e=h.current,t=e=>{let{seatNumber:t,lockedBy:s,lockExpiration:a}=e;y((e=>({lower:e.lower.map((e=>e.seatNumber===t?{...e,isAvailable:!1,lockedBy:s,lockExpiration:a}:e)),upper:e.upper.map((e=>e.seatNumber===t?{...e,isAvailable:!1,lockedBy:s,lockExpiration:a}:e))})))},s=e=>{let{seatNumber:t}=e;y((e=>({lower:e.lower.map((e=>e.seatNumber===t?{...e,isAvailable:!0,lockedBy:null}:e)),upper:e.upper.map((e=>e.seatNumber===t?{...e,isAvailable:!0,lockedBy:null}:e))}))),w[t]&&(clearTimeout(w[t]),k((e=>{const s={...e};return delete s[t],s})))},a=e=>{let{type:t,message:s}=e;S(s),D(!1),"RESERVE_ERROR"===t&&v((e=>e.filter((e=>!e.includes(s.seatNumber)))))};return e.on("seatLocked",t),e.on("seatReleased",s),e.on("error",a),e.on("seatUnavailable",(e=>{let{seatNumber:t}=e;S(`Gh\u1ebf s\u1ed1 ${t} kh\xf4ng kh\u1ea3 d\u1ee5ng`),v((e=>e.filter((e=>e!==t))))})),()=>{e.off("seatLocked",t),e.off("seatReleased",s),e.off("error",a),e.off("seatUnavailable"),Object.values(w).forEach(clearTimeout)}}),[u,t._id,A,w]),(0,a.useEffect)((()=>{s&&t._id&&h.current.emit("joinTrip",t._id)}),[s]);const _=()=>{j.forEach((e=>{h.current.emit("releaseSeat",{tripId:t._id,seatNumber:e})})),v([])};(0,a.useEffect)((()=>{o&&o(_)}),[o,_]);const I=(0,a.useCallback)((async e=>{if(u){D(!0),S(null);try{if(console.log("Selected seat number:",e),j.includes(e)){const s=[...N.lower,...N.upper].find((t=>t.seatNumber===e));if(!s.isAvailable&&s.lockedBy&&s.lockedBy!==u)return void S(`Seat ${e} is temporarily reserved by another user`);console.log("Releasing seat:",e),h.current.emit("releaseSeat",{tripId:t._id,seatNumber:e,userId:u}),v((t=>t.filter((t=>t!==e))))}else console.log("Reserving seat:",e),h.current.emit("reserveSeat",{tripId:t._id,seatNumber:e,userId:u}),v((t=>[...t,e]))}catch(T){console.error("Error in seat selection:",T),S("Failed to process seat selection. Please try again.")}finally{D(!1)}}else S("Vui l\xf2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u1ecdn gh\u1ebf")}),[t._id,u,N,j]),M=(0,a.useCallback)((()=>{0!==j.length?d("/bookingconfirmation",{state:{selectedSeats:j,totalPrice:z(),trip:t}}):S("Please select at least one seat to continue")}),[d,j,t]),z=()=>j.reduce(((e,t)=>{const s=[...N.lower,...N.upper].find((e=>e.seatNumber===t));return s?e+s.price:e}),0);return(0,a.useEffect)((()=>{B(z())}),[j,N]),(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-lg  hover:shadow-xl transition-shadow duration-300",children:[(0,m.jsx)(p,{trip:t,onToggle:c,isOpen:s,loading:C}),s&&(0,m.jsx)(b,{seatsData:N,isLoadingSeats:L,handleSeatSelect:I,selectedSeats:j,lockTimers:w,loading:C,totalPrice:z(),handleContinue:M,error:T,userId:u})]})};var N=s(16181);const y=e=>{let{filters:t={}}=e;const s=(0,r.zy)(),i=(0,r.Zp)(),n=new URLSearchParams(s.search),o=n.get("departureLocation"),d=n.get("arrivalLocation"),h=n.get("departureDate"),x=n.get("returnDate"),u=n.get("ticketCount"),[p,g]=(0,a.useState)([]),[f,j]=(0,a.useState)([]),[b,y]=(0,a.useState)(!0),[w,k]=(0,a.useState)([]),[T,S]=(0,a.useState)(0),[C,D]=(0,a.useState)(null),[R,B]=(0,a.useState)(!1),{data:P,error:L,isLoading:A}=(0,l.pg)({departureLocation:o,arrivalLocation:d,departureDate:h,returnDate:x,ticketCount:u});(0,a.useEffect)((()=>{var e;null!==P&&void 0!==P&&null!==(e=P.data)&&void 0!==e&&e.departureTrips&&(j(P.data.departureTrips),g(P.data.departureTrips))}),[P]),(0,a.useEffect)((()=>{y(!0);const e=setTimeout((()=>{(()=>{let e=[...f];"low"===t.priceRange?e=e.filter((e=>e.basePrice<2e5)):"medium"===t.priceRange?e=e.filter((e=>e.basePrice>=2e5&&e.basePrice<=5e5)):"high"===t.priceRange&&(e=e.filter((e=>e.basePrice>5e5))),t.busOperator&&(e=e.filter((e=>{var s;return(null===(s=e.companyId)||void 0===s?void 0:s._id)===t.busOperator}))),t.busType&&(e=e.filter((e=>e.busType._id===t.busType))),"morning"===t.departureTimeRange?e=e.filter((e=>{const t=new Date(e.departureTime).getHours();return t>=6&&t<12})):"afternoon"===t.departureTimeRange&&(e=e.filter((e=>{const t=new Date(e.departureTime).getHours();return t>=12&&t<18}))),"priceAsc"===t.sort?e.sort(((e,t)=>e.basePrice-t.basePrice)):"priceDesc"===t.sort?e.sort(((e,t)=>t.basePrice-e.basePrice)):"earliest"===t.sort?e.sort(((e,t)=>new Date(e.departureTime)-new Date(t.departureTime))):"latest"===t.sort&&e.sort(((e,t)=>new Date(t.departureTime)-new Date(e.departureTime))),g(e),y(!1),0===e.length&&B(!0)})()}),500);return()=>clearTimeout(e)}),[t,f]),(0,a.useEffect)((()=>{(L||P&&0===P.data.departureTrips.length)&&B(!0)}),[L,P]);if(!o||!d||!h)return(0,m.jsx)("div",{children:"Thi\u1ebfu th\xf4ng tin t\xecm ki\u1ebfm. Vui l\xf2ng th\u1eed l\u1ea1i."});if(b||A)return(0,m.jsx)("div",{className:"container mx-auto py-8",children:(0,m.jsx)(N.A,{})});const _=(e,t,s)=>{k(e),S(t),D(s)};return(0,m.jsxs)("div",{className:"container mx-auto py-8",children:[(0,m.jsx)("div",{children:p.length>0&&(0,m.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["T\xecm th\u1ea5y ",p.length," chuy\u1ebfn xe ph\xf9 h\u1ee3p"]})}),(0,m.jsx)("div",{className:"space-y-4",children:p.map((e=>(0,m.jsx)(v,{trip:e,isOpen:e._id===(null===C||void 0===C?void 0:C._id),onToggle:()=>{D((null===C||void 0===C?void 0:C._id)===e._id?null:e)},onContinue:_},e._id)))}),(0,m.jsxs)(c.A,{title:"Kh\xf4ng t\xecm th\u1ea5y chuy\u1ebfn xe ph\xf9 h\u1ee3p",visible:R,onOk:()=>{B(!1),i("/yeu-cau-mo-chuyen-di")},onCancel:()=>{B(!1)},okText:"Y\xeau c\u1ea7u m\u1edf chuy\u1ebfn \u0111i",cancelText:"\u0110\xf3ng",children:[(0,m.jsx)("p",{children:"Ch\xfang t\xf4i kh\xf4ng t\xecm th\u1ea5y chuy\u1ebfn xe n\xe0o ph\xf9 h\u1ee3p v\u1edbi y\xeau c\u1ea7u c\u1ee7a b\u1ea1n."}),(0,m.jsxs)("p",{children:["B\u1ea1n c\xf3 th\u1ec3 y\xeau c\u1ea7u m\u1edf chuy\u1ebfn \u0111i ph\xf9 h\u1ee3p b\u1eb1ng c\xe1ch nh\u1ea5n v\xe0o n\xfat",(0,m.jsx)("strong",{children:' "Y\xeau c\u1ea7u m\u1edf chuy\u1ebfn \u0111i"'}),"."]})]})]})}},10254:(e,t,s)=>{s.d(t,{D:()=>l,v:()=>i});var a=s(34348),r=s.n(a);const l={parseUTCTimeForForm:e=>e?new Date(e):new Date,formatTimeForServer:e=>e?r()(e).utc().format():null,formatDisplayTime:e=>e?r()(e).tz("Asia/Ho_Chi_Minh").format("DD/MM/YYYY HH:mm"):""},i=e=>e?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e):"0 VND"}}]);
//# sourceMappingURL=336.7b51fe40.chunk.js.map