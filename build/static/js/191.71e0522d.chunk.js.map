{"version":3,"file":"static/js/191.71e0522d.chunk.js","mappings":"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","sources":["components/auth/sidebar/OffersPage.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { \r\n  useGetAllVouchersQuery, \r\n  useRedeemPointsForVoucherMutation, \r\n  useGetUserLoyaltyPointsQuery \r\n} from '../../../Redux/User/apiSlice';\r\nimport { FaGift } from 'react-icons/fa';\r\nimport { GiTwoCoins } from 'react-icons/gi';\r\nimport { Modal, Spin, message } from 'antd';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst OffersPage = () => {\r\n  const userInfo = useSelector((state) => state.user.userInfo);\r\n  const navigate = useNavigate();\r\n\r\n  // Lấy điểm thưởng của người dùng\r\n  const { data: loyaltyPointsData, isLoading: isPointsLoading, error: pointsError ,  refetch: refetchPoints } = useGetUserLoyaltyPointsQuery(undefined, {\r\n    skip: !userInfo,\r\n  });\r\n\r\n  // Lấy danh sách voucher\r\n  const { data: vouchers, error, isLoading, refetch } = useGetAllVouchersQuery(undefined, {\r\n    skip: !userInfo,\r\n  });\r\n\r\n  const [redeemPointsForVoucher, { isLoading: isRedeeming }] = useRedeemPointsForVoucherMutation();\r\n  const [points, setPoints] = useState('');\r\n  const [modalVisible, setModalVisible] = useState(!userInfo);\r\n\r\n  const handleRedeem = async () => {\r\n    if (!points || points <= 0 || isNaN(points)) {\r\n      message.error('Vui lòng nhập số điểm hợp lệ để đổi.');\r\n      return;\r\n    }\r\n    try {\r\n      const response = await redeemPointsForVoucher({ points: parseInt(points) }).unwrap();\r\n      message.success(`Đổi điểm thành công! Bạn đã nhận được voucher giảm ${response.voucher.discount}%`);\r\n      setPoints('');\r\n      refetch(); // Refetch danh sách voucher\r\n      refetchPoints(); \r\n    } catch (error) {\r\n      message.error(error?.data?.message || 'Lỗi khi đổi điểm lấy voucher.');\r\n    }\r\n  };\r\n  \r\n\r\n  const handleModalOk = () => {\r\n    setModalVisible(false);\r\n    navigate('/login');\r\n  };\r\n\r\n  const handleModalCancel = () => {\r\n    setModalVisible(false);\r\n    navigate('/');\r\n  };\r\n\r\n  const handleUseVoucher = () => {\r\n    navigate('/'); // Điều hướng về trang \"/\"\r\n  };\r\n\r\n  if (!userInfo) {\r\n    return (\r\n      <Modal\r\n        title=\"Chưa đăng nhập\"\r\n        visible={modalVisible}\r\n        onOk={handleModalOk}\r\n        onCancel={handleModalCancel}\r\n        okText=\"Đăng nhập\"\r\n        cancelText=\"Quay lại trang chủ\"\r\n      >\r\n        <p>Bạn cần đăng nhập để sử dụng các ưu đãi. Hãy đăng nhập hoặc quay lại trang chủ.</p>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-4\">\r\n      <h2 className=\"text-3xl font-bold text-center text-gray-800 mb-6\">Ưu Đãi & Voucher</h2>\r\n\r\n      {/* Hiển thị điểm thưởng */}\r\n      <div className=\"bg-gradient-to-r from-blue-500 to-purple-500 text-white text-center font-semibold rounded-lg p-6 mb-8 shadow-lg\">\r\n        {isPointsLoading ? (\r\n          <Spin size=\"large\" />\r\n        ) : pointsError ? (\r\n          <p className=\"text-red-500\">Lỗi khi tải điểm thưởng</p>\r\n        ) : (\r\n          <>\r\n            <h3 className=\"text-lg\">Bạn có</h3>\r\n            <h1 className=\"text-4xl font-extrabold underline\">{loyaltyPointsData?.loyaltyPoints || 0}</h1>\r\n            <p>điểm thưởng</p>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Form đổi điểm lấy voucher */}\r\n      <div className=\"bg-white rounded-lg shadow-md p-6 mb-8\">\r\n        <h3 className=\"text-lg font-semibold text-gray-800 mb-4 flex items-center\">\r\n          <GiTwoCoins className=\"text-yellow-500 mr-2\" /> Đổi Điểm Lấy Voucher\r\n        </h3>\r\n        <div className=\"flex items-center gap-4\">\r\n          <input\r\n            type=\"number\"\r\n            value={points}\r\n            onChange={(e) => setPoints(e.target.value.trim())}\r\n            placeholder=\"Nhập điểm\"\r\n            className=\"flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n          <button\r\n            onClick={handleRedeem}\r\n            disabled={isRedeeming}\r\n            className={`bg-blue-600 text-white px-6 py-3 rounded-lg font-bold shadow-md ${\r\n              isRedeeming ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'\r\n            }`}\r\n          >\r\n            {isRedeeming ? 'Đang đổi...' : 'Đổi'}\r\n          </button>\r\n        </div>\r\n        <p className=\"text-gray-500 text-sm mt-2\">100 điểm = voucher giảm 10%</p>\r\n      </div>\r\n\r\n      {/* Danh sách voucher */}\r\n      <div>\r\n        <h3 className=\"text-xl font-semibold text-gray-800 mb-4\">Voucher Của Bạn</h3>\r\n\r\n        {isLoading ? (\r\n          <div className=\"flex justify-center\">\r\n            <Spin size=\"large\" />\r\n          </div>\r\n        ) : error ? (\r\n          <p className=\"text-center text-red-500\">Lỗi khi tải danh sách voucher</p>\r\n        ) : vouchers && vouchers.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            {vouchers.map((voucher) => (\r\n              <div\r\n                key={voucher._id}\r\n                className={`relative p-4 rounded-lg shadow-md border ${\r\n                  voucher.isUsed ? 'bg-gray-100 border-gray-400' : 'bg-white border-blue-300'\r\n                }`}\r\n              >\r\n                <FaGift className=\"absolute top-4 right-4 text-2xl text-yellow-400\" />\r\n                <h4 className=\"text-lg font-bold text-gray-800 mb-2\">Mã: {voucher.code}</h4>\r\n                <p className=\"text-sm text-gray-600\">Giảm giá: {voucher.discount}%</p>\r\n                <p className=\"text-sm text-gray-600\">Số lượng: {voucher.quantity}</p>\r\n                <p className=\"text-sm text-gray-600 mb-4\">\r\n                  Hạn: {new Date(voucher.expiryDate).toLocaleDateString()}\r\n                </p>\r\n                <button\r\n                  onClick={handleUseVoucher} \r\n                  className={`w-full text-center py-2 rounded font-semibold ${\r\n                    voucher.isUsed\r\n                      ? 'bg-gray-400 text-white cursor-not-allowed'\r\n                      : 'bg-blue-600 text-white hover:bg-blue-700'\r\n                  }`}\r\n                  disabled={voucher.isUsed}\r\n                >\r\n                  {voucher.isUsed ? 'Đã sử dụng' : 'Sử dụng ngay'}\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-center text-gray-500\">Không có voucher nào.</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OffersPage;\r\n"],"names":["OffersPage","userInfo","useSelector","state","user","navigate","useNavigate","data","loyaltyPointsData","isLoading","isPointsLoading","error","pointsError","refetch","refetchPoints","useGetUserLoyaltyPointsQuery","undefined","skip","vouchers","useGetAllVouchersQuery","redeemPointsForVoucher","isRedeeming","useRedeemPointsForVoucherMutation","points","setPoints","useState","modalVisible","setModalVisible","handleModalOk","handleModalCancel","handleUseVoucher","_jsxs","className","children","_jsx","Spin","size","_Fragment","loyaltyPoints","GiTwoCoins","type","value","onChange","e","target","trim","placeholder","onClick","async","isNaN","message","response","parseInt","unwrap","success","voucher","discount","_error$data","disabled","length","map","isUsed","FaGift","code","quantity","Date","expiryDate","toLocaleDateString","_id","Modal","title","visible","onOk","onCancel","okText","cancelText"],"sourceRoot":""}