"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[740],{5740:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var r=s(65043),a=s(73216),i=s(65868),l=s(83003),n=s(42104),c=s(91995),o=s(10254),d=s(70579);const m=e=>{let{trip:t,activeTab:s,setActiveTab:r}=e;return(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex border-b mb-4",children:[(0,d.jsx)("button",{className:"px-4 py-2 "+("discounts"===s?"border-b-2 border-blue-500":""),onClick:()=>r("discounts"),children:"Gi\u1ea3m gi\xe1"}),(0,d.jsx)("button",{className:"px-4 py-2 "+("policy"===s?"border-b-2 border-blue-500":""),onClick:()=>r("policy"),children:"Ch\xednh s\xe1ch"}),(0,d.jsx)("button",{className:"px-4 py-2 "+("images"===s?"border-b-2 border-blue-500":""),onClick:()=>r("images"),children:"H\xecnh \u1ea3nh"})]}),(()=>{switch(s){case"discounts":return(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Gi\u1ea3m gi\xe1"}),(0,d.jsxs)("ul",{children:[(0,d.jsx)("li",{children:"Gi\u1ea3m 50% t\u1ed1i \u0111a 250k"}),(0,d.jsx)("li",{children:"Gi\u1ea3m 20% cho v\xe9 \u0111\u1ea7u ti\xean"})]})]});case"policy":return(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Ch\xednh s\xe1ch"}),(0,d.jsx)("p",{children:"Ho\xe0n ti\u1ec1n 100% n\u1ebfu hu\u1ef7 tr\u01b0\u1edbc 24 gi\u1edd."}),(0,d.jsx)("p",{children:"H\u1ed7 tr\u1ee3 \u0111\u1ed5i v\xe9 mi\u1ec5n ph\xed."})]});case"images":return(0,d.jsx)("div",{className:"grid grid-cols-2 gap-4",children:t.busType.images&&t.busType.images.map(((e,t)=>(0,d.jsx)("img",{src:e,alt:`Bus image ${t+1}`,className:"w-full h-32 object-cover rounded-lg"},t)))});default:return null}})()]})};var u=s(31462);const x=e=>{let{trip:t,onToggle:s,loading:a}=e;const[i,l]=(0,r.useState)(!1),[n,x]=(0,r.useState)(!1),[h,p]=(0,r.useState)("discounts"),g=t.busType.images&&t.busType.images.length>0?t.busType.images[0]:"https://via.placeholder.com/150";return(0,d.jsxs)("div",{className:"border border-gray-200  rounded-lg shadow-md hover:shadow-lg p-4 mb-6 transition-shadow",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-4",children:[(0,d.jsxs)("div",{className:"relative w-full md:w-1/5 flex-shrink-0",children:[(0,d.jsx)("img",{src:g,alt:"Bus",className:"w-full h-28 object-cover rounded-lg",onClick:()=>{l(!0),p("images")}}),t.instantConfirmation&&(0,d.jsx)("div",{className:"absolute top-1 left-1 bg-green-600 text-white text-xs px-2 py-1 rounded",children:"X\xe1c nh\u1eadn t\u1ee9c th\xec"})]}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h3",{className:"font-semibold text-lg text-gray-800",children:t.companyId.name}),(0,d.jsxs)("div",{className:"flex items-center",children:[(e=>{const t=Math.floor(e),s=e%1>=.5?1:0,r=5-t-s;return(0,d.jsxs)("div",{className:"flex items-center",children:[Array(t).fill().map(((e,t)=>(0,d.jsx)(u.Lqq,{className:"text-yellow-500"},`full-${t}`))),1===s&&(0,d.jsx)(u.vOy,{className:"text-yellow-500"}),Array(r).fill().map(((e,t)=>(0,d.jsx)(u.oqo,{className:"text-gray-300"},`empty-${t}`)))]})})(t.companyId.averageRating||0),(0,d.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",t.companyId.totalReviews||0,")"]})]})]}),(0,d.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[t.busType.description," (",t.busType.seats," ch\u1ed7)"]}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("p",{className:"text-lg font-bold text-gray-800",children:new Date(t.departureTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:t.departureLocation.name})]}),(0,d.jsxs)("div",{className:"text-center text-gray-400 text-sm",children:[Math.round((new Date(t.arrivalTime)-new Date(t.departureTime))/36e5)||1," ","gi\u1edd"]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("p",{className:"text-lg font-bold text-gray-800",children:new Date(t.arrivalTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:t.arrivalLocation.name})]})]})]}),(0,d.jsxs)("div",{className:"text-right w-full md:w-auto flex-shrink-0",children:[(0,d.jsxs)("p",{className:"text-xl font-bold text-red-600",children:[(0,o.v)(t.basePrice)," VND"]}),t.discount&&(0,d.jsxs)("p",{className:"text-sm text-gray-500 line-through",children:[(0,o.v)(t.originalPrice)," VND"]}),(0,d.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["C\xf2n ",t.availableSeats," ch\u1ed7 tr\u1ed1ng"]}),(0,d.jsx)("button",{onClick:()=>{i&&l(!1),s()},className:"bg-yellow-500 text-white px-5 py-2 mt-2 rounded-lg hover:bg-yellow-600 transition",disabled:a,children:"Ch\u1ecdn chuy\u1ebfn"})]})]}),(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)("button",{onClick:()=>l(!i),className:"text-blue-600 text-sm",children:i?"\u1ea8n chi ti\u1ebft":"Th\xf4ng tin chi ti\u1ebft"})}),i&&(0,d.jsx)("div",{className:"mt-4 bg-gray-100 rounded-lg p-4",children:(0,d.jsx)(m,{trip:t,activeTab:h,setActiveTab:p})}),(0,d.jsx)(c.A,{visible:n,footer:null,onCancel:()=>{x(!1)},title:"H\xecnh \u1ea2nh Xe",children:(0,d.jsx)("div",{className:"grid grid-cols-3 gap-4",children:t.busType.images&&t.busType.images.map(((e,t)=>(0,d.jsx)("img",{src:e,alt:`Bus image ${t+1}`,className:"w-full h-32 object-cover rounded-lg"},t)))})})]})};var h=s(38179),p=s(75088),g=s(60184);const b=e=>{let{seatsData:t,isLoadingSeats:s,handleSeatSelect:r,selectedSeats:a,lockTimers:i,loading:l,totalPrice:n,handleContinue:c,error:m,userId:u}=e;const x=e=>1===e.seatNumber?"text-gray-500 cursor-not-allowed":a.includes(e.seatNumber)?"text-green-500":e.isAvailable?e.lockedBy&&e.lockedBy!==u?"text-orange-500":[2,3,4,5,6].includes(e.seatNumber)?"text-yellow-500":"text-green-300":"text-red-500",b=(e,t)=>{const s=e.length<5?e.length:5;return(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("h4",{className:"font-semibold text-center mb-3 text-gray-700",children:t}),(0,d.jsx)("div",{className:"grid gap-3 mx-auto",style:{gridTemplateColumns:`repeat(${s}, minmax(0, 1fr))`},children:e.map((e=>(0,d.jsxs)("button",{onClick:()=>r(e.seatNumber),disabled:l,className:`text-2xl cursor-pointer ${x(e)}`,children:[(0,d.jsx)(g.n75,{}),i[e.seatNumber]&&(0,d.jsx)(p.A,{className:"absolute -top-1 -right-1 h-4 w-4"})]},e._id)))})]})};return(0,d.jsx)(h.e,{show:!0,enter:"transition-opacity duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,d.jsxs)("div",{className:"border-t mt-4 pt-4 space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-row flex-wrap justify-around space-x-4 mb-4 text-sm text-gray-700",children:[(0,d.jsxs)("div",{className:"flex items-center mb-2",children:[(0,d.jsx)(g.n75,{className:"text-gray-500 mr-2"}),"Gh\u1ebf kh\xf4ng b\xe1n"]}),(0,d.jsxs)("div",{className:"flex items-center mb-2",children:[(0,d.jsx)(g.n75,{className:"text-yellow-500 mr-2"}),"Gh\u1ebf VIP"]}),(0,d.jsxs)("div",{className:"flex items-center mb-2",children:[(0,d.jsx)(g.n75,{className:"text-green-500 mr-2"}),"\u0110\xe3 ch\u1ecdn"]}),(0,d.jsxs)("div",{className:"flex items-center mb-2",children:[(0,d.jsx)(g.n75,{className:"text-orange-500 mr-2"}),"T\u1ea1m th\u1eddi gi\u1eef"]}),(0,d.jsxs)("div",{className:"flex items-center mb-2",children:[(0,d.jsx)(g.n75,{className:"text-green-300 mr-2"}),"C\xf3 s\u1eb5n"]}),(0,d.jsxs)("div",{className:"flex items-center mb-2",children:[(0,d.jsx)(g.n75,{className:"text-red-500 mr-2"}),"\u0110\xe3 \u0111\u1eb7t"]})]}),(0,d.jsxs)("div",{className:"flex justify-center w-full",children:[(0,d.jsx)("div",{className:`w-full ${t.upper?"md:w-1/2":"w-2/3"} flex justify-center`,children:b(t.lower,"T\u1ea7ng D\u01b0\u1edbi")}),t.upper&&t.upper.length>0&&(0,d.jsx)("div",{className:"md:w-z1/2 pl-4",children:b(t.upper,"T\u1ea7ng Tr\xean")})]}),(0,d.jsxs)("div",{className:"mt-6 flex justify-around h-[80px] items-center border-t pt-4",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-700",children:["Gh\u1ebf \u0111\xe3 ch\u1ecdn:"," ",(0,d.jsx)("span",{className:"font-medium",children:a.join(", ")})]}),(0,d.jsxs)("div",{className:"text-lg font-semibold text-gray-900",children:["T\u1ed5ng: ",(0,o.v)(n)," VND"]}),(0,d.jsx)("button",{onClick:c,disabled:0===a.length||l,className:"px-6 py-2 rounded-lg text-white transition duration-300\n              "+(0===a.length||l?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:"Ti\u1ebfp t\u1ee5c"})]}),m&&(0,d.jsx)("p",{className:"text-red-500 mt-2",children:m})]})})},v=e=>{let{trip:t,isOpen:s,onToggle:c,onReleaseSeats:o}=e;const m=(0,a.Zp)(),u=(0,r.useRef)(null),h=(0,l.d4)((e=>e.user.userInfo)),p=null===h||void 0===h?void 0:h.id,[g,v]=(0,r.useState)(null),[f,j]=(0,r.useState)([]),[y,N]=(0,r.useState)({lower:[],upper:[]}),[w,T]=(0,r.useState)({}),[k,S]=(0,r.useState)(null),[D,C]=(0,r.useState)(!1),[_,P]=(0,r.useState)(0),{data:R,isLoading:A}=(0,i.BX)(t._id,{skip:!s}),E=(0,r.useCallback)((()=>{try{return u.current=(0,n.Ay)("http://localhost:5000",{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),u.current.on("connect",(()=>{console.log("Connected to socket server"),s&&t._id&&(u.current.emit("joinTrip",t._id),console.log(`Joining trip room: ${t._id}`))})),u.current.on("connect_error",(e=>{console.error("Socket connection error:",e),S("Unable to connect to booking service. Please try again later.")})),()=>{u.current&&u.current.disconnect()}}catch(k){console.error("Socket setup error:",k),S("Unable to initialize booking service. Please try again later.")}}),[t._id,s]);(0,r.useEffect)((()=>{R&&(N(R.data),S(null))}),[R]),(0,r.useEffect)((()=>{u.current||E();const e=u.current,t=e=>{let{seatNumber:t,lockedBy:s,lockExpiration:r}=e;N((e=>({lower:e.lower.map((e=>e.seatNumber===t?{...e,isAvailable:!1,lockedBy:s,lockExpiration:r}:e)),upper:e.upper.map((e=>e.seatNumber===t?{...e,isAvailable:!1,lockedBy:s,lockExpiration:r}:e))})))},s=e=>{let{seatNumber:t}=e;N((e=>({lower:e.lower.map((e=>e.seatNumber===t?{...e,isAvailable:!0,lockedBy:null}:e)),upper:e.upper.map((e=>e.seatNumber===t?{...e,isAvailable:!0,lockedBy:null}:e))}))),w[t]&&(clearTimeout(w[t]),T((e=>{const s={...e};return delete s[t],s})))},r=e=>{let{type:t,message:s}=e;S(s),C(!1),"RESERVE_ERROR"===t&&j((e=>e.filter((e=>!e.includes(s.seatNumber)))))};return e.on("seatLocked",t),e.on("seatReleased",s),e.on("error",r),e.on("seatUnavailable",(e=>{let{seatNumber:t}=e;S(`Gh\u1ebf s\u1ed1 ${t} kh\xf4ng kh\u1ea3 d\u1ee5ng`),j((e=>e.filter((e=>e!==t))))})),()=>{e.off("seatLocked",t),e.off("seatReleased",s),e.off("error",r),e.off("seatUnavailable"),Object.values(w).forEach(clearTimeout)}}),[p,t._id,E,w]),(0,r.useEffect)((()=>{s&&t._id&&u.current.emit("joinTrip",t._id)}),[s]);const L=()=>{f.forEach((e=>{u.current.emit("releaseSeat",{tripId:t._id,seatNumber:e})})),j([])};(0,r.useEffect)((()=>{o&&o(L)}),[o,L]);const B=(0,r.useCallback)((async e=>{if(p){C(!0),S(null);try{if(console.log("Selected seat number:",e),f.includes(e)){const s=[...y.lower,...y.upper].find((t=>t.seatNumber===e));if(!s.isAvailable&&s.lockedBy&&s.lockedBy!==p)return void S(`Seat ${e} is temporarily reserved by another user`);console.log("Releasing seat:",e),u.current.emit("releaseSeat",{tripId:t._id,seatNumber:e,userId:p}),j((t=>t.filter((t=>t!==e))))}else console.log("Reserving seat:",e),u.current.emit("reserveSeat",{tripId:t._id,seatNumber:e,userId:p}),j((t=>[...t,e]))}catch(k){console.error("Error in seat selection:",k),S("Failed to process seat selection. Please try again.")}finally{C(!1)}}else S("Vui l\xf2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u1ecdn gh\u1ebf")}),[t._id,p,y,f]),I=(0,r.useCallback)((()=>{0!==f.length?m("/bookingconfirmation",{state:{selectedSeats:f,totalPrice:V(),trip:t}}):S("Please select at least one seat to continue")}),[m,f,t]),V=()=>f.reduce(((e,t)=>{const s=[...y.lower,...y.upper].find((e=>e.seatNumber===t));return s?e+s.price:e}),0);return(0,r.useEffect)((()=>{P(V())}),[f,y]),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-lg  hover:shadow-xl transition-shadow duration-300",children:[(0,d.jsx)(x,{trip:t,onToggle:c,isOpen:s,loading:D}),s&&(0,d.jsx)(b,{seatsData:y,isLoadingSeats:A,handleSeatSelect:B,selectedSeats:f,lockTimers:w,loading:D,totalPrice:V(),handleContinue:I,error:k,userId:p})]})};var f=s(16181);const j=e=>{let{filters:t={}}=e;const s=(0,a.zy)(),l=new URLSearchParams(s.search),n=l.get("departureLocation"),c=l.get("arrivalLocation"),o=l.get("departureDate"),m=l.get("returnDate"),u=l.get("ticketCount"),[x,h]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),[b,j]=(0,r.useState)(!0),[y,N]=(0,r.useState)([]),[w,T]=(0,r.useState)(0),[k,S]=(0,r.useState)(null),{data:D,error:C,isLoading:_}=(0,i.pg)({departureLocation:n,arrivalLocation:c,departureDate:o,returnDate:m,ticketCount:u});if((0,r.useEffect)((()=>{var e;null!==D&&void 0!==D&&null!==(e=D.data)&&void 0!==e&&e.departureTrips&&(g(D.data.departureTrips),h(D.data.departureTrips))}),[D]),(0,r.useEffect)((()=>{j(!0);const e=setTimeout((()=>{(()=>{let e=[...p];"low"===t.priceRange?e=e.filter((e=>e.basePrice<2e5)):"medium"===t.priceRange?e=e.filter((e=>e.basePrice>=2e5&&e.basePrice<=5e5)):"high"===t.priceRange&&(e=e.filter((e=>e.basePrice>5e5))),t.busOperator&&(e=e.filter((e=>{var s;return(null===(s=e.busType)||void 0===s?void 0:s.name)===t.busOperator}))),"morning"===t.departureTimeRange?e=e.filter((e=>{const t=new Date(e.departureTime).getHours();return t>=6&&t<12})):"afternoon"===t.departureTimeRange&&(e=e.filter((e=>{const t=new Date(e.departureTime).getHours();return t>=12&&t<18}))),"priceAsc"===t.sort?e.sort(((e,t)=>e.basePrice-t.basePrice)):"priceDesc"===t.sort?e.sort(((e,t)=>t.basePrice-e.basePrice)):"earliest"===t.sort?e.sort(((e,t)=>new Date(e.departureTime)-new Date(t.departureTime))):"latest"===t.sort&&e.sort(((e,t)=>new Date(t.departureTime)-new Date(e.departureTime))),h(e),j(!1)})()}),500);return()=>clearTimeout(e)}),[t,p]),!n||!c||!o)return(0,d.jsx)("div",{children:"Thi\u1ebfu th\xf4ng tin t\xecm ki\u1ebfm. Vui l\xf2ng th\u1eed l\u1ea1i."});if(b||_)return(0,d.jsx)("div",{className:"container mx-auto py-8",children:(0,d.jsx)(f.A,{})});if(C)return(0,d.jsxs)("div",{children:["Kh\xf4ng t\xecm th\u1ea5y chuy\u1ebfn xe. L\u1ed7i: ",C.message]});if(0===x.length)return(0,d.jsx)("div",{children:"Kh\xf4ng t\xecm th\u1ea5y chuy\u1ebfn xe n\xe0o ph\xf9 h\u1ee3p v\u1edbi y\xeau c\u1ea7u t\xecm ki\u1ebfm c\u1ee7a b\u1ea1n."});const P=(e,t,s)=>{N(e),T(t),S(s)};return(0,d.jsxs)("div",{className:"container mx-auto py-8",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"K\u1ebft qu\u1ea3 t\xecm ki\u1ebfm chuy\u1ebfn xe"}),(0,d.jsx)("div",{className:"space-y-4",children:x.map((e=>(0,d.jsx)(v,{trip:e,isOpen:e._id===(null===k||void 0===k?void 0:k._id),onToggle:()=>{S((null===k||void 0===k?void 0:k._id)===e._id?null:e)},onContinue:P},e._id)))})]})}},10254:(e,t,s)=>{s.d(t,{D:()=>i,v:()=>l});var r=s(34348),a=s.n(r);const i={parseUTCTimeForForm:e=>e?new Date(e):new Date,formatTimeForServer:e=>e?a()(e).utc().format():null,formatDisplayTime:e=>e?a()(e).tz("Asia/Ho_Chi_Minh").format("DD/MM/YYYY HH:mm"):""},l=e=>e?new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e):"0 VND"}}]);
//# sourceMappingURL=740.92d5cabe.chunk.js.map